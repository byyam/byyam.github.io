<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Job scheduling</title>
    <url>/2017/12/24/2017-12-24-job-scheduling/</url>
    <content><![CDATA[<p><strong>Job scheduling</strong></p>
<p><strong>作业调度</strong></p>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>多个作业进程（或服务器，后称为process）可处理相同的任务，并具有不同的处理能力。</p>
<h3 id="假设"><a href="#假设" class="headerlink" title="假设"></a>假设</h3><table>
<thead>
<tr>
<th>进程（服务器）</th>
<th>处理能力</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>4</td>
</tr>
<tr>
<td>B</td>
<td>3</td>
</tr>
<tr>
<td>C</td>
<td>2</td>
</tr>
</tbody></table>
<p>在一轮任务（Job）的分配中，均衡的分配给每一个process。</p>
<p>处理能力可认为是分配权重weight。</p>
<h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><h3 id="加权轮询调度"><a href="#加权轮询调度" class="headerlink" title="加权轮询调度"></a>加权轮询调度</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Supposing that there is a server set S &#x3D; &#123;S0, S1, …, Sn-1&#125;;</span><br><span class="line">W(Si) indicates the weight of Si;</span><br><span class="line">i indicates the server selected last time, and i is initialized with -1;</span><br><span class="line">cw is the current weight in scheduling, and cw is initialized with zero; </span><br><span class="line">max(S) is the maximum weight of all the servers in S;</span><br><span class="line">gcd(S) is the greatest common divisor of all server weights in S;</span><br><span class="line"></span><br><span class="line">while (true) &#123;</span><br><span class="line">    i &#x3D; (i + 1) mod n;</span><br><span class="line">    if (i &#x3D;&#x3D; 0) &#123;</span><br><span class="line">        cw &#x3D; cw - gcd(S); </span><br><span class="line">        if (cw &lt;&#x3D; 0) &#123;</span><br><span class="line">            cw &#x3D; max(S);</span><br><span class="line">            if (cw &#x3D;&#x3D; 0)</span><br><span class="line">            return NULL;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    if (W(Si) &gt;&#x3D; cw) </span><br><span class="line">        return Si;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出的结果是<code>AABABCABC</code></p>
<p>这个算法的两个技巧：</p>
<ol>
<li>gcd最大公约数：相当于算法的步长。比如权重为1000，100，10的三个process，分配时可以认为它们是权重为100，10，1.最大公约数为10，循环执行10次的效果是一样的。</li>
<li>当W(Si) &gt;= cw时，才返回Si。这样做的效果是，不同process中优先调用高于其他weight的部分，当所有process剩下的weight相等时，按顺序循环调用。</li>
</ol>
<h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><p><a href="https://gist.github.com/byyam/6fe49cc9861b9134025c8234517f778a">python实现</a></p>
<h3 id="更为随机的加权轮询调度"><a href="#更为随机的加权轮询调度" class="headerlink" title="更为随机的加权轮询调度"></a>更为随机的加权轮询调度</h3><p>设想<code>A，B，C</code>的权值分别为<code>5，1，1</code>的情景下，以上的调度算法输出为<code>AAAAABC</code></p>
<p>定义：</p>
<ol>
<li>每个process的动态当前权值current weight为cw</li>
<li>每个process的固有权值weight为w</li>
<li>参加轮询的process的weight之和为sw</li>
</ol>
<p>算法：</p>
<ol>
<li>每个cw初始值为0</li>
<li>每个cw = cw + w</li>
<li>被选中的process为cw最大的，被选中后cw的值被惩罚为该process的cw减去sw，而其他process的cw保持不变。即max(cw) - sw</li>
<li>若所有process的cw都为0，则一轮结束。否则，进行下一步</li>
<li>跳到第2步</li>
</ol>
<p>运算：</p>
<p>奇数行根据最大的current weight选择process</p>
<p>被选中的cw被高亮标出</p>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td><code>5</code></td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>-2</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td><code>3</code></td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>-4</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>1</td>
<td><code>3</code></td>
<td>3</td>
</tr>
<tr>
<td>1</td>
<td>-4</td>
<td>3</td>
</tr>
<tr>
<td><code>6</code></td>
<td>-3</td>
<td>4</td>
</tr>
<tr>
<td>-1</td>
<td>-3</td>
<td>4</td>
</tr>
<tr>
<td>4</td>
<td>-2</td>
<td><code>5</code></td>
</tr>
<tr>
<td>4</td>
<td>-2</td>
<td>-2</td>
</tr>
<tr>
<td><code>9</code></td>
<td>-1</td>
<td>-1</td>
</tr>
<tr>
<td>2</td>
<td>-1</td>
<td>-1</td>
</tr>
<tr>
<td><code>7</code></td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody></table>
<p>技巧：</p>
<ol>
<li>算法里循环执行的<code>cw = cw + w</code>和<code>max（cw）-sw</code>两个步骤确保了cw之和等于sw，循环次数为<code>sw</code>次</li>
<li>和上一个算法相比，该算法每次让被选出来的process尽可能的排在最后面，确保了不会有连续的被选中</li>
</ol>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p>加权轮询调度算法：</p>
<p><a href="http://kb.linuxvirtualserver.org/wiki/Weighted_Round-Robin_Scheduling">http://kb.linuxvirtualserver.org/wiki/Weighted_Round-Robin_Scheduling</a></p>
]]></content>
      <categories>
        <category>algorithms</category>
      </categories>
  </entry>
  <entry>
    <title>Research of gcov</title>
    <url>/2014/02/27/2014-02-28-research-of-gcov/</url>
    <content><![CDATA[<h2 id="编译安装合适的gcc版本"><a href="#编译安装合适的gcc版本" class="headerlink" title="编译安装合适的gcc版本"></a>编译安装合适的gcc版本</h2><p>下载gcc包<br><code>gcc-version-xx.tar.bz2</code></p>
<p>解压<br><code>tar -jxvf gcc-version-xx.tar.bz2</code></p>
<p>进入目录<br><code>cd gcc-version-xx</code></p>
<p>执行configure试一下看缺少了什么依赖<br><code>./configure</code></p>
<p>(如本次缺少两个库，<code>mpfr</code> 和 <code>gmp</code>，可以用软件管理器安装，也可以自己添加库。</p>
<p>下载这两个包，解压放在gcc-version-xx目录，并且把目录的版本号删掉，名字改为： mpfr 和 gmp )<br>再试一下是否生成了Makefile文件</p>
<p><code>../gcc-version-xx/configure --prefix=yourdir/gcc-version-xx/</code></p>
<h2 id="编译包含flush-gcov函数的库：静态库与共享库的区别"><a href="#编译包含flush-gcov函数的库：静态库与共享库的区别" class="headerlink" title="编译包含flush gcov函数的库：静态库与共享库的区别"></a>编译包含flush gcov函数的库：静态库与共享库的区别</h2><blockquote>
<p>动态库（-fprofile-arcs -ftest-coverage可能是第二步不必要的选项）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -c -fPIC libats.c -fprofile-arcs -ftest-coverage</span><br><span class="line"></span><br><span class="line">gcc -fprofile-arcs -ftest-coverage -shared -o libats.so libats.o</span><br><span class="line"></span><br><span class="line">gcc -fprofile-arcs -ftest-coverage test.c -g -L. -lats -Iats -o test</span><br></pre></td></tr></table></figure>

<p>运行期间刷出的gcda只是libats的</p>
<blockquote>
<p>静态库</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -c libats.c -fprofile-arcs -ftest-coverage</span><br><span class="line"></span><br><span class="line">ar -cr libats.a libats.o </span><br><span class="line"></span><br><span class="line">gcc -fprofile-arcs -ftest-coverage test.c -g -L. -lats -Iats -o test</span><br></pre></td></tr></table></figure>

<p>运行期间刷出的gcda是libats和test全部的</p>
<p>this program is not .so<br>flush gcov的范围是this program</p>
<p>readelf -l objectfile<br>动态链接库是有自己的program header<br>被编译进来或者静态库没有program header</p>
<blockquote>
<p>结论</p>
</blockquote>
<p>包含libgcov.a并在运行期间调用flush_gcov函数，只能在静态库中操作，因为动态库有自己的program header。</p>
<p>除此之外，一般的函数静态或动态编译并没本质区别。只是加载时期不同而已。</p>
<h2 id="编译处理过程"><a href="#编译处理过程" class="headerlink" title="编译处理过程"></a>编译处理过程</h2><blockquote>
<p>预处理 -E</p>
</blockquote>
<p>程序员代码-&gt;编译器识别的代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@Test gcov]# gcc -E test_merge_gcda.c -o test_merge_gcda.i</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译 -S</p>
</blockquote>
<p>代码-&gt;汇编代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@Test gcov]# gcc -S test_merge_gcda.i </span><br></pre></td></tr></table></figure>

<blockquote>
<p>合并以上两步</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -S -ftest-coverage -fprofile-arcs test.i</span><br></pre></td></tr></table></figure>

<blockquote>
<p>汇编 -c</p>
</blockquote>
<p>代码-&gt;机器码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@Test gcov]# gcc -c test_merge_gcda.s -o test_merge_gcda.o</span><br></pre></td></tr></table></figure>

<blockquote>
<p>链接</p>
</blockquote>
<p>机器码-&gt;可执行文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@Test gcov]# gcc -o test_merge_gcda test_merge_gcda.o</span><br></pre></td></tr></table></figure>

<blockquote>
<p>合并以上两步</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -o test_merge_gcda test_merge_gcda.o -lgov</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@Test gcov]# ls</span><br><span class="line">test_merge_gcda  test_merge_gcda.c  test_merge_gcda.i  test_merge_gcda.o  test_merge_gcda.s</span><br></pre></td></tr></table></figure>

<h2 id="gcc-coverage理解"><a href="#gcc-coverage理解" class="headerlink" title="gcc coverage理解"></a>gcc coverage理解</h2><h4 id="生成gcno的原理？"><a href="#生成gcno的原理？" class="headerlink" title="生成gcno的原理？"></a>生成gcno的原理？</h4><p>在汇编代码插入gcov的一些计数器，链接生成可执行文件时，生成gcno文件。</p>
<h4 id="在哪插入？"><a href="#在哪插入？" class="headerlink" title="在哪插入？"></a>在哪插入？</h4><p>每个BB后面会插入一个，具体说应该是连通各个的地方。(但是逻辑图和实际图不一致，因此stub并不等于arc)</p>
<h4 id="何为BB？"><a href="#何为BB？" class="headerlink" title="何为BB？"></a>何为BB？</h4><p>basic block， 基本块。<br>每个基本块只有一个入口，一个出口，因此是原子的。<br>同一行代码可以同时属于多个BB。</p>
<h4 id="生成gcda的原理？"><a href="#生成gcda的原理？" class="headerlink" title="生成gcda的原理？"></a>生成gcda的原理？</h4><p>执行时，被插入的代码会记录每个arc被运行的次数（counter），程序执行结束，最后一个被插入代码会把counter信息写入gcda文件。</p>
<h4 id="生成gcov的原理？"><a href="#生成gcov的原理？" class="headerlink" title="生成gcov的原理？"></a>生成gcov的原理？</h4><p>根据BB和分支记录的原始信息，和运行时的counter信息（或加之源文件），算出每行被执行的次数。</p>
<h4 id="gcov记录的信息？"><a href="#gcov记录的信息？" class="headerlink" title="gcov记录的信息？"></a>gcov记录的信息？</h4><p>BB和分支。</p>
<h4 id="gcda记录的信息？"><a href="#gcda记录的信息？" class="headerlink" title="gcda记录的信息？"></a>gcda记录的信息？</h4><p>执行时每个arc被运行的次数，推算出每个BB执行的次数，从而算出每个函数执行次数。</p>
<p>如何分析代码产生BB，即确定插桩stub位置？<br>此问题即对应bb图和源码行，从二维到一维的关系。</p>
<h4 id="gcno中block，arcs，line？"><a href="#gcno中block，arcs，line？" class="headerlink" title="gcno中block，arcs，line？"></a>gcno中block，arcs，line？</h4><p>实际BB，虚拟BB。<br>虚拟BB包括start和end，中间也可能存在虚拟BB。</p>
<p>LINE数目为真实BB的个数，记录的是每个BB在哪个文件所对应的行数。（因为有可能编译的时候包括进来其他文件）<br>ARCS数目为所有BB个数-1，即每个有出度的BB，所指向的BB号码。</p>
<p>每个ARCS长度为（1+出度*2），表示的是，自身BB标号+指向BB标号和?<br>（源码里是dest和flag）</p>
<h4 id="如果根据gcda记录的-arc-counter信息确定每个bb执行次数？"><a href="#如果根据gcda记录的-arc-counter信息确定每个bb执行次数？" class="headerlink" title="如果根据gcda记录的 arc counter信息确定每个bb执行次数？"></a>如果根据gcda记录的 arc counter信息确定每个bb执行次数？</h4><p>arc counter的个数为插桩点的个数，从源码线性确定每个分段被执行过的路径。</p>
<h4 id="何为branch？"><a href="#何为branch？" class="headerlink" title="何为branch？"></a>何为branch？</h4><p>传统理解的分支，一个逻辑块。</p>
<p><a href="https://github.com/byyam/yamcov">我的代码实现</a></p>
]]></content>
      <categories>
        <category>gcov</category>
      </categories>
  </entry>
  <entry>
    <title>Golang</title>
    <url>/2020/05/26/2020-05-27-golang/</url>
    <content><![CDATA[<p><a href="/images/svg/Golang.svg">outline</a><br><img src="/images/svg/Golang.svg"></p>
<p>支持判等类型: 布尔，数字，字符串，指针，接口，通道，结构体，包含上述类型的数组<br>不支持判等类型: slice, map, function</p>
<p><a href="/images/svg/context.svg">context</a><br><img src="/images/svg/context.svg"></p>
]]></content>
      <categories>
        <category>go</category>
      </categories>
  </entry>
  <entry>
    <title>WebSocket</title>
    <url>/2020/03/06/2020-03-07-websocket/</url>
    <content><![CDATA[<h3 id="全双工协议"><a href="#全双工协议" class="headerlink" title="全双工协议"></a>全双工协议</h3><p>简而言之，许多应用场景需要全双工的web应用，例如：服务器主动推送和实时交互的应用。这些应用不适合在HTTP协议上实现。最好的方式是使用HTTP建立握手，之后基于TCP做长连接。</p>
<p>与HTTP的关系是：使用了其握手机制和端口号。</p>
<blockquote>
<p>Relationship to TCP and HTTP</p>
</blockquote>
<blockquote>
<p>   The WebSocket Protocol is an independent TCP-based protocol.  Its<br>   only relationship to HTTP is that its handshake is interpreted by<br>   HTTP servers as an Upgrade request.</p>
</blockquote>
<blockquote>
<p>   By default, the WebSocket Protocol uses port 80 for regular WebSocket<br>   connections and port 443 for WebSocket connections tunneled over<br>   Transport Layer Security (TLS) [RFC2818].</p>
</blockquote>
<p>   <a href="https://en.wikipedia.org/wiki/Comparison_of_WebSocket_implementations">支持WebSocket的浏览器</a></p>
<h3 id="握手"><a href="#握手" class="headerlink" title="握手"></a>握手</h3><p>WebSocket通过HTTP/1.1协议的101状态码握手。</p>
<p><strong>客户端发起握手请求：</strong></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">ws://localhost:6060/ws</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:6060</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Upgrade   # 连接升级</span><br><span class="line"><span class="attribute">Pragma</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36</span><br><span class="line"><span class="attribute">Upgrade</span><span class="punctuation">: </span>websocket    # 升级到WebSocket</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://localhost:6060</span><br><span class="line"><span class="attribute">Sec-WebSocket-Version</span><span class="punctuation">: </span>13   # 表示支持的WebSocket版本</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,ja;q=0.6,zh-TW;q=0.5</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>wp-settings-time-1=1566626634</span><br><span class="line"><span class="attribute">Sec-WebSocket-Key</span><span class="punctuation">: </span>Omt7iN7CaEUxYdm+wlVEaA==</span><br><span class="line"><span class="attribute">Sec-WebSocket-Extensions</span><span class="punctuation">: </span>permessage-deflate; client_max_window_bits</span><br></pre></td></tr></table></figure>

<p><strong>服务器回应</strong></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">101</span> Switching Protocols</span><br><span class="line"><span class="attribute">Upgrade</span><span class="punctuation">: </span>websocket</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Upgrade</span><br><span class="line"><span class="attribute">Sec-WebSocket-Accept</span><span class="punctuation">: </span>ggdcU6xoySObbFCh62I2J3eRxu0=</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Sec-WebSocket-Key</code>是随机的字符串，服务器端会用这些数据来构造出一个SHA-1的信息摘要。把<code>Sec-WebSocket-Key</code>加上一个特殊字符串（固定）：<code>258EAFA5-E914-47DA-95CA-C5AB0DC85B11</code>，然后计算SHA-1摘要，之后进行BASE-64编码，将结果做为<code>Sec-WebSocket-Accept</code>头的值，返回给客户端。如此操作，可以尽量避免普通HTTP请求被误认为Websocket协议。</li>
</ul>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 固定字符串</span></span><br><span class="line"><span class="keyword">var</span> keyGUID = []<span class="keyword">byte</span>(<span class="string">&quot;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务器根据客户端请求的随机key计算Sec-WebSocket-Accept字段的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">computeAcceptKey</span><span class="params">(challengeKey <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	h := sha1.New()</span><br><span class="line">	h.Write([]<span class="keyword">byte</span>(challengeKey))</span><br><span class="line">	h.Write(keyGUID)</span><br><span class="line">	<span class="keyword">return</span> base64.StdEncoding.EncodeToString(h.Sum(<span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端生成随机key</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generateChallengeKey</span><span class="params">()</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">	p := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">16</span>)</span><br><span class="line">	<span class="keyword">if</span> _, err := io.ReadFull(rand.Reader, p); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> base64.StdEncoding.EncodeToString(p), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>Origin</code>字段是可选的，通常用来表示在浏览器中发起此Websocket连接所在的页面。</li>
</ul>
<h3 id="协议格式"><a href="#协议格式" class="headerlink" title="协议格式"></a>协议格式</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> 0                   1                   2                   3</span><br><span class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">+-+-+-+-+-------+-+-------------+-------------------------------+</span><br><span class="line">|F|R|R|R| opcode|M| Payload len |    Extended payload length    |</span><br><span class="line">|I|S|S|S|  (4)  |A|     (7)     |             (16&#x2F;64)           |</span><br><span class="line">|N|V|V|V|       |S|             |   (if payload len&#x3D;&#x3D;126&#x2F;127)   |</span><br><span class="line">| |1|2|3|       |K|             |                               |</span><br><span class="line">+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +</span><br><span class="line">|     Extended payload length continued, if payload len &#x3D;&#x3D; 127  |</span><br><span class="line">+ - - - - - - - - - - - - - - - +-------------------------------+</span><br><span class="line">|                               |Masking-key, if MASK set to 1  |</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">| Masking-key (continued)       |          Payload Data         |</span><br><span class="line">+-------------------------------- - - - - - - - - - - - - - - - +</span><br><span class="line">:                     Payload Data continued ...                :</span><br><span class="line">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br><span class="line">|                     Payload Data continued ...                |</span><br><span class="line">+---------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<ul>
<li><code>FIN</code>为true表示是最后一个分片。</li>
<li><code>RSV</code>一般情况都为0。</li>
<li><code>opcode</code> 定义了<code>payload data</code>的类型。</li>
<li><code>mask</code>为true表示payload是编码处理的。</li>
<li><code>masking-key</code>编码key。</li>
<li><code>payload length</code>表示payload的长度。</li>
</ul>
<p>extend为payload过长时的扩展字段。</p>
<p>客户端发给服务器的包，必须masking：</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> wordSize = <span class="keyword">int</span>(unsafe.Sizeof(<span class="keyword">uintptr</span>(<span class="number">0</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 随机生成masking-key</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newMaskKey</span><span class="params">()</span> [4]<span class="title">byte</span></span> &#123;</span><br><span class="line">	n := rand.Uint32()</span><br><span class="line">	<span class="keyword">return</span> [<span class="number">4</span>]<span class="keyword">byte</span>&#123;<span class="keyword">byte</span>(n), <span class="keyword">byte</span>(n &gt;&gt; <span class="number">8</span>), <span class="keyword">byte</span>(n &gt;&gt; <span class="number">16</span>), <span class="keyword">byte</span>(n &gt;&gt; <span class="number">24</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maskBytes</span><span class="params">(key [4]<span class="keyword">byte</span>, pos <span class="keyword">int</span>, b []<span class="keyword">byte</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="comment">// Mask one byte at a time for small buffers.</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b) &lt; <span class="number">2</span>*wordSize &#123;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="keyword">range</span> b &#123;</span><br><span class="line">			b[i] ^= key[pos&amp;<span class="number">3</span>]</span><br><span class="line">			pos++</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> pos &amp; <span class="number">3</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Mask one byte at a time to word boundary.</span></span><br><span class="line">	<span class="keyword">if</span> n := <span class="keyword">int</span>(<span class="keyword">uintptr</span>(unsafe.Pointer(&amp;b[<span class="number">0</span>]))) % wordSize; n != <span class="number">0</span> &#123;</span><br><span class="line">		n = wordSize - n</span><br><span class="line">		<span class="keyword">for</span> i := <span class="keyword">range</span> b[:n] &#123;</span><br><span class="line">			b[i] ^= key[pos&amp;<span class="number">3</span>]</span><br><span class="line">			pos++</span><br><span class="line">		&#125;</span><br><span class="line">		b = b[n:]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Create aligned word size key.</span></span><br><span class="line">	<span class="keyword">var</span> k [wordSize]<span class="keyword">byte</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> k &#123;</span><br><span class="line">		k[i] = key[(pos+i)&amp;<span class="number">3</span>]</span><br><span class="line">	&#125;</span><br><span class="line">	kw := *(*<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;k))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Mask one word at a time.</span></span><br><span class="line">	n := (<span class="built_in">len</span>(b) / wordSize) * wordSize</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i += wordSize &#123;</span><br><span class="line">		*(*<span class="keyword">uintptr</span>)(unsafe.Pointer(<span class="keyword">uintptr</span>(unsafe.Pointer(&amp;b[<span class="number">0</span>])) + <span class="keyword">uintptr</span>(i))) ^= kw</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Mask one byte at a time for remaining bytes.</span></span><br><span class="line">	b = b[n:]</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> b &#123;</span><br><span class="line">		b[i] ^= key[pos&amp;<span class="number">3</span>]</span><br><span class="line">		pos++</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> pos &amp; <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="控制消息"><a href="#控制消息" class="headerlink" title="控制消息"></a>控制消息</h3><p>WebSocket定义了3种类型的控制消息（control message）：close, ping and pong。</p>
<p><strong>close</strong></p>
<p><code>opcode</code>为0x8</p>
<p>客户端发起的close，<code>websocket.payload.close.status_code</code>置为1000，表示normal closure。若不设置，则默认为CloseNoStatusReceived=1005。</p>
<p>服务器收到关闭请求，响应包也发送1000。</p>
<p>客户端收到响应后，执行TCP四次挥手过长，双方关闭TCP连接。</p>
<p>在实际捕获websocket的close code时，应注意以下细节：</p>
<ul>
<li><code>1006</code>属于错误码，并不是可从<code>SetCloseHandler</code>中捕获到的，因为它没有真正的发送close消息。</li>
<li>若websocket由Nginx代理，应考虑Nginx可能会主动发送close的情况，因此应该从读取message的地方去获取断开原因，因为<code>SetCloseHandler</code>有可能会接收到Nginx发来的close状态。</li>
</ul>
<p><strong>ping</strong></p>
<p><code>opcode</code>为0x9</p>
<p>发送方 -&gt; 接收方</p>
<blockquote>
<p> WebSocket为了保持客户端、服务端的实时双向通信，需要确保客户端、服务端之间的TCP通道保持连接没有断开。然而，对于长时间没有数据往来的连接，如果依旧长时间保持着，可能会浪费包括的连接资源。但不排除有些场景，客户端、服务端虽然长时间没有数据往来，但仍需要保持连接。这个时候，可以采用心跳来实现。</p>
</blockquote>
<blockquote>
<p>如果客户端支持ping，最好由客户端发起ping，然后服务器记录时间，超时断开即可。浏览器中没有相关api发送ping给服务器，只能由服务器发ping给浏览器。</p>
</blockquote>
<p><strong>pong</strong></p>
<p><code>opcode</code>为0xA</p>
<p>接收方 -&gt; 发送方</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://tools.ietf.org/html/rfc6455">https://tools.ietf.org/html/rfc6455</a></p>
<p><a href="https://zh.wikipedia.org/wiki/WebSocket">https://zh.wikipedia.org/wiki/WebSocket</a></p>
<p><a href="https://godoc.org/github.com/gorilla/websocket">https://godoc.org/github.com/gorilla/websocket</a></p>
<p><a href="https://github.com/gorilla/websocket">https://github.com/gorilla/websocket</a></p>
<p><a href="https://github.com/gorilla/websocket/blob/master/examples/chat/client.go">websocket ping/pong timeout</a></p>
]]></content>
      <categories>
        <category>protocol</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL</title>
    <url>/2020/05/26/2020-05-27-mysql/</url>
    <content><![CDATA[<p><a href="/images/svg/MySQL.svg">outline</a><br><img src="/images/svg/MySQL.svg"></p>
]]></content>
      <categories>
        <category>database</category>
      </categories>
  </entry>
  <entry>
    <title>Mediasoup</title>
    <url>/2021/04/09/2021-04-10-mediasoup/</url>
    <content><![CDATA[<h1 id="mediasoup"><a href="#mediasoup" class="headerlink" title="mediasoup"></a>mediasoup</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>v3版本源码实现了SFU的基本转发功能，由C++部分的worker和TS部分的信令组成。这两部分之间用Unix domain socket通信，是进程之间的全双工通信方式，基于文件系统，不需要走协议栈，因此必须同机部署。</p>
<p><strong>peer</strong></p>
<p>逻辑层抽象，代表了通话的成员。</p>
<p><strong>room</strong> </p>
<p>逻辑层通常和router绑定，代表了通话的房间。</p>
<p><strong>router</strong></p>
<p>模型层代表了媒体流转发的单元，一个router内包含了transport, producer, consumer这些模型的实例。<br>记录了transport和流的包含关系，还有producer和consumer的映射关系，主要负责从transport中获取数据包和producer/consumer的流媒体转发。</p>
<p><strong>transport</strong></p>
<p>数据层抽象，代表了一路socket层面的数据流，可以承载多个RTP stream。通常一个典型的通话里，上行和下行需要分别建立两个socket连接，就是两个transport。客户端与mediasoup之间的transport通常是<code>webrtcTransport</code>。mediasoup之间的routers也可以建立transport实现级联关系，通常是<code>pipeTransport</code>。发给GStreamer和ffmepg的为<code>plainTransport</code>。</p>
<p>基于socket的webrtcTransport的ICE只支持Lite模式，一方面是因为作者并非将它设计为商业用途，另一方面mediasoup的STUN把自己也当成一个host，简单实现了协议功能。</p>
<p><strong>producer</strong></p>
<p>媒体流的生产者。</p>
<p><strong>consumer</strong></p>
<p>媒体流的消费者。</p>
<h2 id="源码结构"><a href="#源码结构" class="headerlink" title="源码结构"></a>源码结构</h2><p><a href="/images/svg/mediasoup.svg">mediasoup</a><br><img src="/images/svg/mediasoup.svg"></p>
<h2 id="实现协议"><a href="#实现协议" class="headerlink" title="实现协议"></a>实现协议</h2><p>WebRTC实现连接的ICE和能力协商的SDP都属于描述性协议，并不严格规定具体的实现。因此信令层面由mediasoup官方提供的<a href="https://github.com/versatica/mediasoup-demo">demo</a>和<a href="https://github.com/versatica/libmediasoupclient">client-cpp</a>,<a href="https://github.com/versatica/mediasoup-client">client-js</a>等实现具体基于webrtc的调用，这部分代码主要在demo。数据层则是实现了RTP/RTCP协议的基本传输和反馈能力，这部分代码主要在worker。client-cpp提供了调用webrtc-native的API，client-js则是调用支持webrtc的浏览器端提供的API。client和demo/worker通过私有信令和标准协议通信实现了基本的RTC功能。</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI5MTRweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjkyMnB4O2hlaWdodDo5MTRweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA5MjIgOTE0IiB3aWR0aD0iOTIycHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI5LjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI0MzcuNSIgeT0iOTYuNTYyNSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iOTMuMzk4NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjQzNy41IiB5PSIxODMuOTYwOSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iNjEuMjY1NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjQzNy41IiB5PSIzMzUuNjI1Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI5My4zOTg0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iNDM3LjUiIHk9IjUyMi40MjE5Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIxMTkuNTMxMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjQzNy41IiB5PSI2NzQuMDg1OSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMzIuMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjY2Mi41IiB5PSIyMTYuMDkzOCIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMzIuMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjY2Mi41IiB5PSIzOTYuODkwNiIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMzIuMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjY2Mi41IiB5PSI1NTQuNTU0NyIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMjkuMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjY2Mi41IiB5PSI3MDMuMjE4OCIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMzIuMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjY2Mi41IiB5PSI3OTMuNjE3MiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSIzNyIgeDI9IjM3IiB5MT0iMzYuMjk2OSIgeTI9Ijg3OC44ODI4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjE2MyIgeDI9IjE2MyIgeTE9IjM2LjI5NjkiIHkyPSI4NzguODgyOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSI0NDIiIHgyPSI0NDIiIHkxPSIzNi4yOTY5IiB5Mj0iODc4Ljg4MjgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iNjY3LjUiIHgyPSI2NjcuNSIgeTE9IjM2LjI5NjkiIHkyPSI4NzguODgyOCIvPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjUiIHg9IjUiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MSIgeD0iMTIiIHk9IjI0Ljk5NTEiPndlYnJ0YzwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjY1IiB4PSI1IiB5PSI4NzcuODgyOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUxIiB4PSIxMiIgeT0iODk3Ljg3NzkiPndlYnJ0YzwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjU1IiB4PSIxMzYiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MSIgeD0iMTQzIiB5PSIyNC45OTUxIj5jbGllbnQ8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1NSIgeD0iMTM2IiB5PSI4NzcuODgyOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxIiB4PSIxNDMiIHk9Ijg5Ny44Nzc5Ij5jbGllbnQ8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1NSIgeD0iNDE1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEiIHg9IjQyMiIgeT0iMjQuOTk1MSI+ZGVtbzwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjU1IiB4PSI0MTUiIHk9Ijg3Ny44ODI4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEiIHg9IjQyMiIgeT0iODk3Ljg3NzkiPmRlbW88L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5MiIgeD0iNjIxLjUiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OCIgeD0iNjI4LjUiIHk9IjI0Ljk5NTEiPm1lZGlhc291cDwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkyIiB4PSI2MjEuNSIgeT0iODc3Ljg4MjgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OCIgeD0iNjI4LjUiIHk9Ijg5Ny44Nzc5Ij5tZWRpYXNvdXA8L3RleHQ+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIyOS4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iNDM3LjUiIHk9Ijk2LjU2MjUiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjkzLjM5ODQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI0MzcuNSIgeT0iMTgzLjk2MDkiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjYxLjI2NTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI0MzcuNSIgeT0iMzM1LjYyNSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iOTMuMzk4NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjQzNy41IiB5PSI1MjIuNDIxOSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMTE5LjUzMTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI0MzcuNSIgeT0iNjc0LjA4NTkiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjMyLjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI2NjIuNSIgeT0iMjE2LjA5MzgiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjMyLjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI2NjIuNSIgeT0iMzk2Ljg5MDYiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjMyLjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI2NjIuNSIgeT0iNTU0LjU1NDciLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI5LjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI2NjIuNSIgeT0iNzAzLjIxODgiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjMyLjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI2NjIuNSIgeT0iNzkzLjYxNzIiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE1MS41LDYzLjQyOTcsMTYxLjUsNjcuNDI5NywxNTEuNSw3MS40Mjk3LDE1NS41LDY3LjQyOTciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Mi4wLDIuMDsiIHgxPSIzNy41IiB4Mj0iMTU3LjUiIHkxPSI2Ny40Mjk3IiB5Mj0iNjcuNDI5NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMiIgeD0iNDQuNSIgeT0iNjIuMzYzOCI+Z2V0TWVkaWFEZXZpY2U8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MjUuNSw5Mi41NjI1LDQzNS41LDk2LjU2MjUsNDI1LjUsMTAwLjU2MjUsNDI5LjUsOTYuNTYyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTYzLjUiIHgyPSI0MzEuNSIgeTE9Ijk2LjU2MjUiIHkyPSI5Ni41NjI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU5IiB4PSIxNzAuNSIgeT0iOTEuNDk2NiI+Z2V0Um91dGVyUnRwQ2FwYWJpbGl0aWVzPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTc0LjUsMTIxLjY5NTMsMTY0LjUsMTI1LjY5NTMsMTc0LjUsMTI5LjY5NTMsMTcwLjUsMTI1LjY5NTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE2OC41IiB4Mj0iNDQxLjUiIHkxPSIxMjUuNjk1MyIgeTI9IjEyNS42OTUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTg3IiB4PSIxODAuNSIgeT0iMTIwLjYyOTQiPui/lOWbnm1lZGlhc291cOaUr+aMgeeahFJUUOiDveWKmzwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ4LjUsMTUwLjgyODEsMzguNSwxNTQuODI4MSw0OC41LDE1OC44MjgxLDQ0LjUsMTU0LjgyODEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Mi4wLDIuMDsiIHgxPSI0Mi41IiB4Mj0iMTYyLjUiIHkxPSIxNTQuODI4MSIgeTI9IjE1NC44MjgxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTAiIHg9IjU0LjUiIHk9IjE0OS43NjIyIj5zZXQgU0RQPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDI1LjUsMTc5Ljk2MDksNDM1LjUsMTgzLjk2MDksNDI1LjUsMTg3Ljk2MDksNDI5LjUsMTgzLjk2MDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE2My41IiB4Mj0iNDMxLjUiIHkxPSIxODMuOTYwOSIgeTI9IjE4My45NjA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjE4IiB4PSIxNzAuNSIgeT0iMTc4Ljg5NSI+Y3JlYXRlV2ViUnRjVHJhbnNwb3J0KHVwL2Rvd24pPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjUwLjUsMjEyLjA5MzgsNjYwLjUsMjE2LjA5MzgsNjUwLjUsMjIwLjA5MzgsNjU0LjUsMjE2LjA5MzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjQ0Ny41IiB4Mj0iNjU2LjUiIHkxPSIyMTYuMDkzOCIgeTI9IjIxNi4wOTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk2IiB4PSI0NTQuNSIgeT0iMjExLjAyNzgiPnJvdXRlci5jcmVhdGVXZWJSdGNUcmFuc3BvcnQ8L3RleHQ+PHBhdGggZD0iTTY3NywxOTYuOTYwOSBMNjc3LDIyMS45NjA5IEw4NTEsMjIxLjk2MDkgTDg1MSwyMDYuOTYwOSBMODQxLDE5Ni45NjA5IEw2NzcsMTk2Ljk2MDkgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNODQxLDE5Ni45NjA5IEw4NDEsMjA2Ljk2MDkgTDg1MSwyMDYuOTYwOSBMODQxLDE5Ni45NjA5ICIgZmlsbD0iI0ZGRkZGRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUzIiB4PSI2ODMiIHk9IjIxNC4wMjc4Ij7liJvlu7rkuIrkuIvooYzkuKTkuKpUcmFuc3BvcnQ8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NTguNSwyNDQuMjI2Niw0NDguNSwyNDguMjI2Niw0NTguNSwyNTIuMjI2Niw0NTQuNSwyNDguMjI2NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDUyLjUiIHgyPSI2NjYuNSIgeTE9IjI0OC4yMjY2IiB5Mj0iMjQ4LjIyNjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjAiIHg9IjQ2NC41IiB5PSIyNDMuMTYwNiI+SUNFL0RUTFMvU0NUUOWPguaVsDwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3NC41LDI3My4zNTk0LDE2NC41LDI3Ny4zNTk0LDE3NC41LDI4MS4zNTk0LDE3MC41LDI3Ny4zNTk0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNjguNSIgeDI9IjQ0MS41IiB5MT0iMjc3LjM1OTQiIHkyPSIyNzcuMzU5NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMCIgeD0iMTgwLjUiIHk9IjI3Mi4yOTM1Ij5JQ0UvRFRMUy9TQ1RQ5Y+C5pWwPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDguNSwzMDIuNDkyMiwzOC41LDMwNi40OTIyLDQ4LjUsMzEwLjQ5MjIsNDQuNSwzMDYuNDkyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToyLjAsMi4wOyIgeDE9IjQyLjUiIHgyPSIxNjIuNSIgeTE9IjMwNi40OTIyIiB5Mj0iMzA2LjQ5MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MCIgeD0iNTQuNSIgeT0iMzAxLjQyNjMiPnNldCBTRFA8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MjUuNSwzMzEuNjI1LDQzNS41LDMzNS42MjUsNDI1LjUsMzM5LjYyNSw0MjkuNSwzMzUuNjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNjMuNSIgeDI9IjQzMS41IiB5MT0iMzM1LjYyNSIgeTI9IjMzNS42MjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMiIgeD0iMTcwLjUiIHk9IjMzMC41NTkxIj5qb2luPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTc0LjUsMzYwLjc1NzgsMTY0LjUsMzY0Ljc1NzgsMTc0LjUsMzY4Ljc1NzgsMTcwLjUsMzY0Ljc1NzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE2OC41IiB4Mj0iNDM2LjUiIHkxPSIzNjQuNzU3OCIgeTI9IjM2NC43NTc4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzQiIHg9IjE4MC41IiB5PSIzNTkuNjkxOSI+b3RoZXIgcGVlcnM8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NTAuNSwzOTIuODkwNiw2NjAuNSwzOTYuODkwNiw2NTAuNSw0MDAuODkwNiw2NTQuNSwzOTYuODkwNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDQyLjUiIHgyPSI2NTYuNSIgeTE9IjM5Ni44OTA2IiB5Mj0iMzk2Ljg5MDYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjIiIHg9IjQ0OS41IiB5PSIzOTEuODI0NyI+dHJhbnNwb3J0LmNvbnN1bWU8L3RleHQ+PHBhdGggZD0iTTY3NywzNzcuNzU3OCBMNjc3LDQwMi43NTc4IEw5MTUsNDAyLjc1NzggTDkxNSwzODcuNzU3OCBMOTA1LDM3Ny43NTc4IEw2NzcsMzc3Ljc1NzggIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNOTA1LDM3Ny43NTc4IEw5MDUsMzg3Ljc1NzggTDkxNSwzODcuNzU3OCBMOTA1LDM3Ny43NTc4ICIgZmlsbD0iI0ZGRkZGRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjE3IiB4PSI2ODMiIHk9IjM5NC44MjQ3Ij7lnKhUcmFuc3BvcnTkuIrlu7rnq4tjb25zdW1lcueahOaYoOWwhDwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ1My41LDQyNS4wMjM0LDQ0My41LDQyOS4wMjM0LDQ1My41LDQzMy4wMjM0LDQ0OS41LDQyOS4wMjM0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0NDcuNSIgeDI9IjY2Ni41IiB5MT0iNDI5LjAyMzQiIHkyPSI0MjkuMDIzNCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2MCIgeD0iNDU5LjUiIHk9IjQyMy45NTc1Ij5wcm9kdWNlcuWSjGNvbnN1bWVy54q25oCBPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTc0LjUsNDU3LjE1NjMsMTY0LjUsNDYxLjE1NjMsMTc0LjUsNDY1LjE1NjMsMTcwLjUsNDYxLjE1NjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE2OC41IiB4Mj0iNDQxLjUiIHkxPSI0NjEuMTU2MyIgeTI9IjQ2MS4xNTYzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjI5IiB4PSIxODAuNSIgeT0iNDU2LjA5MDMiPuWPkee7meiHquW3sW5ld0NvbnN1bWVyKGF1ZGlvL3ZpZGVvKTwvdGV4dD48cGF0aCBkPSJNNDQ3LDQ0Mi4wMjM0IEw0NDcsNDY3LjAyMzQgTDcxNSw0NjcuMDIzNCBMNzE1LDQ1Mi4wMjM0IEw3MDUsNDQyLjAyMzQgTDQ0Nyw0NDIuMDIzNCAiIGZpbGw9IiNGRkZGRkYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik03MDUsNDQyLjAyMzQgTDcwNSw0NTIuMDIzNCBMNzE1LDQ1Mi4wMjM0IEw3MDUsNDQyLjAyMzQgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNDciIHg9IjQ1MyIgeT0iNDU5LjA5MDMiPuaKiuaWsOi/m+aIv+aIkOWRmOW9k+WBmuWFtuS7luW3sue7j+i/m+aIv+aIkOWRmOeahOS4i+ihjDwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE1MS41LDQ4OS4yODkxLDE2MS41LDQ5My4yODkxLDE1MS41LDQ5Ny4yODkxLDE1NS41LDQ5My4yODkxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjIuMCwyLjA7IiB4MT0iMzcuNSIgeDI9IjE1Ny41IiB5MT0iNDkzLjI4OTEiIHkyPSI0OTMuMjg5MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU5IiB4PSI0NC41IiB5PSI0ODguMjIzMSI+RFRMU+WPguaVsDwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQyNS41LDUxOC40MjE5LDQzNS41LDUyMi40MjE5LDQyNS41LDUyNi40MjE5LDQyOS41LDUyMi40MjE5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNjMuNSIgeDI9IjQzMS41IiB5MT0iNTIyLjQyMTkiIHkyPSI1MjIuNDIxOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyOCIgeD0iMTcwLjUiIHk9IjUxNy4zNTYiPmNvbm5lY3RXZWJSdGNUcmFuc3BvcnQodXAvZG93bik8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NTAuNSw1NTAuNTU0Nyw2NjAuNSw1NTQuNTU0Nyw2NTAuNSw1NTguNTU0Nyw2NTQuNSw1NTQuNTU0NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDQ3LjUiIHgyPSI2NTYuNSIgeTE9IjU1NC41NTQ3IiB5Mj0iNTU0LjU1NDciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTQiIHg9IjQ1NC41IiB5PSI1NDkuNDg4OCI+dHJhbnNwb3J0LmNvbm5lY3Q8L3RleHQ+PHBhdGggZD0iTTY3Nyw1MzUuNDIxOSBMNjc3LDU2MC40MjE5IEw3ODMsNTYwLjQyMTkgTDc4Myw1NDUuNDIxOSBMNzczLDUzNS40MjE5IEw2NzcsNTM1LjQyMTkgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNzczLDUzNS40MjE5IEw3NzMsNTQ1LjQyMTkgTDc4Myw1NDUuNDIxOSBMNzczLDUzNS40MjE5ICIgZmlsbD0iI0ZGRkZGRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODUiIHg9IjY4MyIgeT0iNTUyLjQ4ODgiPuiuvue9rkRUTFPlj4LmlbA8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NTguNSw1ODIuNjg3NSw0NDguNSw1ODYuNjg3NSw0NTguNSw1OTAuNjg3NSw0NTQuNSw1ODYuNjg3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDUyLjUiIHgyPSI2NjYuNSIgeTE9IjU4Ni42ODc1IiB5Mj0iNTg2LjY4NzUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNSIgeD0iNDY0LjUiIHk9IjU4MS42MjE2Ij5vazwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3NC41LDYxMS44MjAzLDE2NC41LDYxNS44MjAzLDE3NC41LDYxOS44MjAzLDE3MC41LDYxNS44MjAzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNjguNSIgeDI9IjQ0MS41IiB5MT0iNjE1LjgyMDMiIHkyPSI2MTUuODIwMyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1IiB4PSIxODAuNSIgeT0iNjEwLjc1NDQiPm9rPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDguNSw2NDAuOTUzMSwzOC41LDY0NC45NTMxLDQ4LjUsNjQ4Ljk1MzEsNDQuNSw2NDQuOTUzMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToyLjAsMi4wOyIgeDE9IjQyLjUiIHgyPSIxNjIuNSIgeTE9IjY0NC45NTMxIiB5Mj0iNjQ0Ljk1MzEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNSIgeD0iNTQuNSIgeT0iNjM5Ljg4NzIiPm9rPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDI1LjUsNjcwLjA4NTksNDM1LjUsNjc0LjA4NTksNDI1LjUsNjc4LjA4NTksNDI5LjUsNjc0LjA4NTkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE2My41IiB4Mj0iNDMxLjUiIHkxPSI2NzQuMDg1OSIgeTI9IjY3NC4wODU5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM2IiB4PSIxNzAuNSIgeT0iNjY5LjAyIj5wcm9kdWNlKGF1ZGlvL3ZpZGVvKTwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY1MC41LDY5OS4yMTg4LDY2MC41LDcwMy4yMTg4LDY1MC41LDcwNy4yMTg4LDY1NC41LDcwMy4yMTg4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0NDcuNSIgeDI9IjY1Ni41IiB5MT0iNzAzLjIxODgiIHkyPSI3MDMuMjE4OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNSIgeD0iNDU0LjUiIHk9IjY5OC4xNTI4Ij50cmFuc3BvcnQucHJvZHVjZTwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ1OC41LDcyOC4zNTE2LDQ0OC41LDczMi4zNTE2LDQ1OC41LDczNi4zNTE2LDQ1NC41LDczMi4zNTE2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0NTIuNSIgeDI9IjY2Ni41IiB5MT0iNzMyLjM1MTYiIHkyPSI3MzIuMzUxNiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMiIgeD0iNDY0LjUiIHk9IjcyNy4yODU2Ij5wcm9kdWNlciBSVFDlj4LmlbA8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNzQuNSw3NTcuNDg0NCwxNjQuNSw3NjEuNDg0NCwxNzQuNSw3NjUuNDg0NCwxNzAuNSw3NjEuNDg0NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTY4LjUiIHgyPSI0MzYuNSIgeTE9Ijc2MS40ODQ0IiB5Mj0iNzYxLjQ4NDQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MSIgeD0iMTgwLjUiIHk9Ijc1Ni40MTg1Ij5SVFDlj4LmlbA8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NTAuNSw3ODkuNjE3Miw2NjAuNSw3OTMuNjE3Miw2NTAuNSw3OTcuNjE3Miw2NTQuNSw3OTMuNjE3MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDQyLjUiIHgyPSI2NTYuNSIgeTE9Ijc5My42MTcyIiB5Mj0iNzkzLjYxNzIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjIiIHg9IjQ0OS41IiB5PSI3ODguNTUxMyI+dHJhbnNwb3J0LmNvbnN1bWU8L3RleHQ+PHBhdGggZD0iTTY3Nyw3NzQuNDg0NCBMNjc3LDc5OS40ODQ0IEw5MTUsNzk5LjQ4NDQgTDkxNSw3ODQuNDg0NCBMOTA1LDc3NC40ODQ0IEw2NzcsNzc0LjQ4NDQgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNOTA1LDc3NC40ODQ0IEw5MDUsNzg0LjQ4NDQgTDkxNSw3ODQuNDg0NCBMOTA1LDc3NC40ODQ0ICIgZmlsbD0iI0ZGRkZGRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjE3IiB4PSI2ODMiIHk9Ijc5MS41NTEzIj7lnKhUcmFuc3BvcnTkuIrlu7rnq4tjb25zdW1lcueahOaYoOWwhDwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ1My41LDgyMS43NSw0NDMuNSw4MjUuNzUsNDUzLjUsODI5Ljc1LDQ0OS41LDgyNS43NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDQ3LjUiIHgyPSI2NjYuNSIgeTE9IjgyNS43NSIgeTI9IjgyNS43NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2MCIgeD0iNDU5LjUiIHk9IjgyMC42ODQxIj5wcm9kdWNlcuWSjGNvbnN1bWVy54q25oCBPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTc0LjUsODUzLjg4MjgsMTY0LjUsODU3Ljg4MjgsMTc0LjUsODYxLjg4MjgsMTcwLjUsODU3Ljg4MjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE2OC41IiB4Mj0iNDQxLjUiIHkxPSI4NTcuODgyOCIgeTI9Ijg1Ny44ODI4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjU1IiB4PSIxODAuNSIgeT0iODUyLjgxNjkiPumAmuefpeWFtuS7luaIkOWRmG5ld0NvbnN1bWVyKGF1ZGlvL3ZpZGVvKTwvdGV4dD48cGF0aCBkPSJNNDQ3LDgzOC43NSBMNDQ3LDg2My43NSBMNjc2LDg2My43NSBMNjc2LDg0OC43NSBMNjY2LDgzOC43NSBMNDQ3LDgzOC43NSAiIGZpbGw9IiNGRkZGRkYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik02NjYsODM4Ljc1IEw2NjYsODQ4Ljc1IEw2NzYsODQ4Ljc1IEw2NjYsODM4Ljc1ICIgZmlsbD0iI0ZGRkZGRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjA4IiB4PSI0NTMiIHk9Ijg1NS44MTY5Ij7mnInmlrDkuIrooYzvvIznu5nlhbbku5bmiJDlkZjliJvlu7rkuIvooYzovazlj5E8L3RleHQ+PCEtLU1ENT1bN2RmNDE4ODA2ODBlYWY2ZmZiYjQ1ZWI4ZjFiYzcxNzddCkBzdGFydHVtbA0Kc2tpbnBhcmFtIE5vdGVCYWNrZ3JvdW5kQ29sb3Igd2hpdGUNCg0Kd2VicnRjIC0gLT4gY2xpZW50IDogZ2V0TWVkaWFEZXZpY2UgDQpjbGllbnQgLT4gZGVtbyA6IGdldFJvdXRlclJ0cENhcGFiaWxpdGllcw0KYWN0aXZhdGUgZGVtbw0KZGVtbyAtPiBjbGllbnQgOiDov5Tlm55tZWRpYXNvdXDmlK/mjIHnmoRSVFDog73lipsNCmRlYWN0aXZhdGUgZGVtbw0KY2xpZW50IC0gLT4gd2VicnRjIDogc2V0IFNEUA0KDQpjbGllbnQgLT4gZGVtbyA6IGNyZWF0ZVdlYlJ0Y1RyYW5zcG9ydCh1cC9kb3duKQ0KYWN0aXZhdGUgZGVtbw0KZGVtbyAtPiBtZWRpYXNvdXAgOiByb3V0ZXIuY3JlYXRlV2ViUnRjVHJhbnNwb3J0DQphY3RpdmF0ZSBtZWRpYXNvdXANCm5vdGUgcmlnaHQgOiDliJvlu7rkuIrkuIvooYzkuKTkuKpUcmFuc3BvcnQNCm1lZGlhc291cCAtPiBkZW1vIDogSUNFL0RUTFMvU0NUUOWPguaVsA0KZGVhY3RpdmF0ZSBtZWRpYXNvdXANCmRlbW8gLT4gY2xpZW50IDogSUNFL0RUTFMvU0NUUOWPguaVsA0KZGVhY3RpdmF0ZSBkZW1vDQpjbGllbnQgLSAtPiB3ZWJydGMgOiBzZXQgU0RQDQoNCmNsaWVudCAtPiBkZW1vIDogam9pbg0KYWN0aXZhdGUgZGVtbw0KZGVtbyAtPiBjbGllbnQgOiBvdGhlciBwZWVycw0KZGVtbyAtPiBtZWRpYXNvdXAgOiB0cmFuc3BvcnQuY29uc3VtZQ0KZGVhY3RpdmF0ZSBkZW1vDQphY3RpdmF0ZSBtZWRpYXNvdXANCm5vdGUgcmlnaHQgOiDlnKhUcmFuc3BvcnTkuIrlu7rnq4tjb25zdW1lcueahOaYoOWwhA0KbWVkaWFzb3VwIC0+IGRlbW8gOiBwcm9kdWNlcuWSjGNvbnN1bWVy54q25oCBDQpkZWFjdGl2YXRlIG1lZGlhc291cA0KZGVtbyAtPiBjbGllbnQgOiDlj5Hnu5noh6rlt7FuZXdDb25zdW1lcihhdWRpby92aWRlbykNCm5vdGUgcmlnaHQgOiDmiormlrDov5vmiL/miJDlkZjlvZPlgZrlhbbku5blt7Lnu4/ov5vmiL/miJDlkZjnmoTkuIvooYwNCg0Kd2VicnRjIC0gLT4gY2xpZW50IDogRFRMU+WPguaVsA0KY2xpZW50IC0+IGRlbW8gOiBjb25uZWN0V2ViUnRjVHJhbnNwb3J0KHVwL2Rvd24pDQphY3RpdmF0ZSBkZW1vDQpkZW1vIC0+IG1lZGlhc291cCA6IHRyYW5zcG9ydC5jb25uZWN0DQphY3RpdmF0ZSBtZWRpYXNvdXANCm5vdGUgcmlnaHQgOiDorr7nva5EVExT5Y+C5pWwDQptZWRpYXNvdXAgLT4gZGVtbyA6IG9rDQpkZWFjdGl2YXRlIG1lZGlhc291cA0KZGVtbyAtPiBjbGllbnQgOiBvaw0KZGVhY3RpdmF0ZSBkZW1vDQpjbGllbnQgLSAtPiB3ZWJydGMgOiBvaw0KDQpjbGllbnQgLT4gZGVtbyA6IHByb2R1Y2UoYXVkaW8vdmlkZW8pDQphY3RpdmF0ZSBkZW1vDQpkZW1vIC0+IG1lZGlhc291cCA6IHRyYW5zcG9ydC5wcm9kdWNlDQphY3RpdmF0ZSBtZWRpYXNvdXANCm1lZGlhc291cCAtPiBkZW1vIDogcHJvZHVjZXIgUlRQ5Y+C5pWwDQpkZWFjdGl2YXRlIG1lZGlhc291cA0KZGVtbyAtPiBjbGllbnQgOiBSVFDlj4LmlbANCmRlbW8gLT4gbWVkaWFzb3VwIDogdHJhbnNwb3J0LmNvbnN1bWUNCmRlYWN0aXZhdGUgZGVtbw0KYWN0aXZhdGUgbWVkaWFzb3VwDQpub3RlIHJpZ2h0IDog5ZyoVHJhbnNwb3J05LiK5bu656uLY29uc3VtZXLnmoTmmKDlsIQNCm1lZGlhc291cCAtPiBkZW1vIDogcHJvZHVjZXLlkoxjb25zdW1lcueKtuaAgQ0KZGVhY3RpdmF0ZSBtZWRpYXNvdXANCmRlbW8gLT4gY2xpZW50IDog6YCa55+l5YW25LuW5oiQ5ZGYbmV3Q29uc3VtZXIoYXVkaW8vdmlkZW8pDQpub3RlIHJpZ2h0IDog5pyJ5paw5LiK6KGM77yM57uZ5YW25LuW5oiQ5ZGY5Yib5bu65LiL6KGM6L2s5Y+RDQpAZW5kdW1sDQoKUGxhbnRVTUwgdmVyc2lvbiAxLjIwMjIuMTBiZXRhMihVbmtub3duIGNvbXBpbGUgdGltZSkKKEdQTCBzb3VyY2UgZGlzdHJpYnV0aW9uKQpKYXZhIFJ1bnRpbWU6IEphdmEoVE0pIFNFIFJ1bnRpbWUgRW52aXJvbm1lbnQKSlZNOiBKYXZhIEhvdFNwb3QoVE0pIDY0LUJpdCBTZXJ2ZXIgVk0KRGVmYXVsdCBFbmNvZGluZzogVVRGLTgKTGFuZ3VhZ2U6IGVuCkNvdW50cnk6IFVTCi0tPjwvZz48L3N2Zz4='>
<h2 id="动手实现一个Mediasoup-client"><a href="#动手实现一个Mediasoup-client" class="headerlink" title="动手实现一个Mediasoup client"></a>动手实现一个Mediasoup client</h2><p>使用pion提供的webrtc库实现一个可以对接mediasoup的client小工具，使用的语言主要为golang。</p>
<h3 id="建立媒体传输通道"><a href="#建立媒体传输通道" class="headerlink" title="建立媒体传输通道"></a>建立媒体传输通道</h3><p>因为mediasoup把SDP拆成了几条信令在websocket上协商，因此需要把SDP中的字段拆解成所需要的字段封装在client端和给mediasoup server。</p>
<h4 id="ICE"><a href="#ICE" class="headerlink" title="ICE"></a>ICE</h4><p>从webrtc transport信令中拿到candidate列表，因为mediasoup是lite的ICE，client端是controlling，mediasoup是controlled，只需要从client去建立连接即可。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 创建ice agent</span></span><br><span class="line">iceAgent, err := ice.NewAgent(&amp;ice.AgentConfig&#123;</span><br><span class="line">    NetworkTypes: []ice.NetworkType&#123;ice.NetworkTypeUDP4&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把candidate加入ice的列表里</span></span><br><span class="line">iceAgent.AddRemoteCandidate(candidate)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立连接</span></span><br><span class="line">iceConn, err := iceAgent.Dial(context.Background(), rsp.Answer.IceParameters.UsernameFragment, rsp.Answer.IceParameters.Password)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>至此，和webrtctransport的ice连接就建立了一半，接下来在ice的基础上做dtls密钥交换。</p>
<h4 id="DTLS"><a href="#DTLS" class="headerlink" title="DTLS"></a>DTLS</h4><p>mediasoup支持双向的dtls连接，dtls之后将密钥导出到ice的connection，对rtp的payload进行加密，媒体数据走的是srtp标准协议。</p>
<p>生成dtls证书和指纹</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 不使用pem证书文件，自签名生成证书，对证书计算摘要</span></span><br><span class="line"><span class="keyword">var</span> tlsCerts []tls.Certificate</span><br><span class="line">certificate, err := selfsign.GenerateSelfSigned()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mediasoupFPs, tlsCerts, err</span><br><span class="line">&#125;</span><br><span class="line">x509cert, err := x509.ParseCertificate(certificate.Certificate[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mediasoupFPs, tlsCerts, err</span><br><span class="line">&#125;</span><br><span class="line">actualSHA256, err := fingerprint.Fingerprint(x509cert, crypto.SHA256)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mediasoupFPs, tlsCerts, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将dtls指纹参数通过信令发送给mediasoup，然后进行dtls连接即可，dtls可使用server也可以使用client，通过信令参数均可调整。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">config := &amp;dtls.Config&#123;</span><br><span class="line">    Certificates:         tlsCerts,</span><br><span class="line">    ExtendedMasterSecret: dtls.RequireExtendedMasterSecret,</span><br><span class="line">    <span class="comment">// Create timeout context for accepted connection.</span></span><br><span class="line">    ConnectContextMaker: <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="params">(context.Context, <span class="keyword">func</span>()</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> context.WithTimeout(context.Background(), <span class="number">30</span>*time.Second)</span><br><span class="line">    &#125;,</span><br><span class="line">    SRTPProtectionProfiles: []dtls.SRTPProtectionProfile&#123;dtls.SRTP_AES128_CM_HMAC_SHA1_80&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dtlsConn, err := dtls.Server(iceConn, config) <span class="comment">// or Client</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>至此，媒体通道webrtc transport已经建立。</p>
<h3 id="媒体传输"><a href="#媒体传输" class="headerlink" title="媒体传输"></a>媒体传输</h3><p>srtp不需要对整个数据包进行加密，因此收发数据仍然是在ice的connection上进行，但是将dtls的密钥导出用于加密每一个rtp的payload。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 导出dtls密钥</span></span><br><span class="line">srtpConfig := &amp;srtp.Config&#123;</span><br><span class="line">    Profile: srtp.ProtectionProfileAes128CmHmacSha1_80,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">connState := dtlsConn.ConnectionState()</span><br><span class="line"><span class="keyword">if</span> err := srtpConfig.ExtractSessionKeysFromDTLS(&amp;connState, <span class="literal">false</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;errDtlsKeyExtractionFailed: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立srtp session</span></span><br><span class="line">srtpSession, err := srtp.NewSessionSRTP(iceConn, srtpConfig)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立srtp读写handler</span></span><br><span class="line">rtpWriteStream, err := srtpSession.OpenWriteStream()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立srtcp session</span></span><br><span class="line">srtcpSession, err := srtp.NewSessionSRTCP(iceConn, srtpConfig)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立srtcp读写handler</span></span><br><span class="line">rtcpReadStream, err := srtcpSession.OpenReadStream(opt.SSRC)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将RTP包的header和payload分别填入handler即可在之前建立的媒体通道上进行收发媒体。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://github.com/versatica/mediasoup">源码实现</a></p>
<p><a href="https://mediasoup.org/">官网</a></p>
<p><a href="https://mediasoup.discourse.group/">官方讨论组</a></p>
<p><a href="https://github.com/jiyeyuran/mediasoup-go">golang实现信令层</a></p>
]]></content>
      <categories>
        <category>media</category>
      </categories>
  </entry>
  <entry>
    <title>RTC</title>
    <url>/2020/10/03/2020-10-04-rtc/</url>
    <content><![CDATA[<h1 id="RTC"><a href="#RTC" class="headerlink" title="RTC"></a>RTC</h1><h2 id="RTC-Server"><a href="#RTC-Server" class="headerlink" title="RTC Server"></a>RTC Server</h2><h3 id="流媒体服务器"><a href="#流媒体服务器" class="headerlink" title="流媒体服务器"></a>流媒体服务器</h3><p>媒体数据的传输，实现实时传输的最基本功能。</p>
<h3 id="信令服务器"><a href="#信令服务器" class="headerlink" title="信令服务器"></a>信令服务器</h3><p>管理多路用户的逻辑，将多个通信用户组建房间进行权限控制和资源管理。</p>
<h3 id="打洞服务器"><a href="#打洞服务器" class="headerlink" title="打洞服务器"></a>打洞服务器</h3><p>为媒体传输提供更丰富的传输通道。</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><strong>CDN</strong></p>
<p>提供就近接入和媒体缓存。</p>
<p><strong>专线</strong></p>
<p>复杂网络情况中提升各运营商之间传输质量。</p>
<p><img src="/images/pic/RTC.png" alt="RTC"></p>
<h2 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h2><p>NAT解决了IPv4资源不足问题，将端口和IP隐藏在内网，从而提高安全性</p>
<ol>
<li>完全锥型</li>
<li>IP限制型</li>
<li>端口限制型</li>
<li>对称型</li>
</ol>
<p><img src="/images/pic/STUN.png" alt="STUN"></p>
<p>组网的网关就像一道墙，阻隔着外部host和内网host直接访问。身处两个NAT后面的host不得不借助于打洞服务器来探测和协助两个host相互访问。因此，以上4种类型的组合情况有12种。</p>
<p><strong>完全锥形</strong>比较容易理解，就是一个四元组：</p>
<pre><code> &#123;
   内网IP，
   内网端口，
   映射的外网IP，
   映射的外网端口
 &#125;
 
</code></pre>
<p>这个映射四元组就是墙上的“洞”，NAT通过查找这个映射表来转发数据。完全锥形没有任何限制，内网的任何host都可以通过这个“洞”和外界通信。</p>
<p><strong>IP限制型</strong>，多加了一个元组：</p>
<blockquote>
<p>被访问主机的IP</p>
</blockquote>
<p>即限制了内网其他IP的host不能通过这个洞。</p>
<p><strong>端口限制型</strong>，又多加了一个元组：</p>
<blockquote>
<p>被访问主机的端口</p>
</blockquote>
<p>即限制了内网同个host的其他端口不能通过这个洞。</p>
<p>最复杂和多变的对称型，对于同一个外网host访问内网host1和host2，它映射的IP和端口都是变化的，因此：<code>对称型—对称型</code>和<code>对称型—端口限制型</code>这两种情况在STUN中是无法穿越的。</p>
<p>NAT穿越为媒体传输通道提供了直连的选择，同一局域网应该首选直连通道。其他情况可根据业务需求和质量情况来判断选择哪种通道。</p>
<h2 id="多对多通信"><a href="#多对多通信" class="headerlink" title="多对多通信"></a>多对多通信</h2><h3 id="Mesh方案"><a href="#Mesh方案" class="headerlink" title="Mesh方案"></a>Mesh方案</h3><p>思想基于一对一方案，将每个host之间都建立一个连接，且每个host之间都能打通直连通道。</p>
<p>局限性：</p>
<ol>
<li>现实场景中，不一定每个host之间都能建立直连通道</li>
<li>共享媒体流的时候，将给每个对端发送一份数据，上行带宽很大</li>
</ol>
<h3 id="MCU方案"><a href="#MCU方案" class="headerlink" title="MCU方案"></a>MCU方案</h3><p><strong>Multipoint Conferencing Unit</strong></p>
<p>服务器进行多路混流和重新编码，视频会议场景等，对服务器硬件要求高。<br>优势很明显，场景体验好，节省带宽资源。<br>局限性也很明显，对服务器要求高，混流过程有一定的延时。</p>
<h3 id="SFU方案"><a href="#SFU方案" class="headerlink" title="SFU方案"></a>SFU方案</h3><p><strong>Selective Forwarding Unit</strong></p>
<p>服务器对多路流根据实际场景进行转发。</p>
<h3 id="传输质量"><a href="#传输质量" class="headerlink" title="传输质量"></a>传输质量</h3><p><img src="/images/pic/QoS.png" alt="QoS"></p>
<h3 id="流媒体传输协议"><a href="#流媒体传输协议" class="headerlink" title="流媒体传输协议"></a>流媒体传输协议</h3><p>传统直播推拉流架构的主要协议：HLS和RTMP协议。</p>
<p>由于WebRTC传输数据基于UDP协议，RTMP基于TCP协议，HLS基于HTTP协议的特点，传输实时性：<code>WebRTC(RTCP/RTP) &gt; RTMP &gt; HLS</code></p>
<ul>
<li>WebRTC多用于实时音视频通信或互动场景</li>
<li>RTMP多用于推拉流场景</li>
<li>HLS多用于拉流端和点播场景</li>
</ul>
<p><img src="/images/pic/HLS.png" alt="HLS"></p>
<h2 id="算法设计"><a href="#算法设计" class="headerlink" title="算法设计"></a>算法设计</h2><p>在实时传输中，一般使用UDP协议，因此需要对抗丢包，乱序，抖动等质量问题。在实时和可靠之间做权衡，一切都是trade-off。</p>
<h3 id="NACK"><a href="#NACK" class="headerlink" title="NACK"></a>NACK</h3><h4 id="NACK-receiver"><a href="#NACK-receiver" class="headerlink" title="NACK receiver"></a>NACK receiver</h4><p>目标： 既要做到及时快速的重传，又要避免过多过久的重传，减少带宽的使用。</p>
<p>思路1： 收到包时记录seq，定时检查最近1000个包里丢失了哪些，发送RTCP NACK请求。<br>问题：定时器间隔导致丢包不能快速请求。</p>
<p>思路2： 思路1+每次收到包都触发一次快速请求重传。<br>问题：乱序时误重传，浪费带宽。</p>
<p>思路3： 思路2+为避免即时和定时频繁发送NACK请求的问题，根据rtt推算是否在定时器触发时需要再次请求NACK，并记录包的重传次数，超过一定次数则停止再发重传请求。</p>
<p>弱网环境下的补充：若重传队列过长，可清理至上一个keyframe处的seq。若队列还是过长，可直接清空重传队列，并发送RTCP PLI请求。</p>
<h4 id="NACK-sender"><a href="#NACK-sender" class="headerlink" title="NACK sender"></a>NACK sender</h4><p>sfu的sender应尽量减少包拷贝次数，多个发送端使用统一发包队列，只记录每个sender的索引。</p>
<h2 id="RTC端到端"><a href="#RTC端到端" class="headerlink" title="RTC端到端"></a>RTC端到端</h2><h3 id="发送端"><a href="#发送端" class="headerlink" title="发送端"></a>发送端</h3><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI2M3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NDE2cHg7aGVpZ2h0OjYzcHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNDE2IDYzIiB3aWR0aD0iNDE2cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48ZyBpZD0iY29sbGVjdCI+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1MCIgeD0iNyIgeT0iNyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjciIHgyPSI1NyIgeTE9IjMzLjI5NjkiIHkyPSIzMy4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjgiIHg9IjE4IiB5PSIyNC45OTUxIj7ph4fpm4Y8L3RleHQ+PC9nPjxnIGlkPSJwcmVwcm9jZXNzIj48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjUwIiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjYyIiB4PSI5MiIgeT0iNyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjkyIiB4Mj0iMTU0IiB5MT0iMzMuMjk2OSIgeTI9IjMzLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MiIgeD0iMTAyIiB5PSIyNC45OTUxIj7liY3lpITnkIY8L3RleHQ+PC9nPjxnIGlkPSJlbmNvZGUiPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTAiIHg9IjE4OSIgeT0iNyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE4OSIgeDI9IjIzOSIgeTE9IjMzLjI5NjkiIHkyPSIzMy4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjgiIHg9IjIwMCIgeT0iMjQuOTk1MSI+57yW56CBPC90ZXh0PjwvZz48ZyBpZD0icGFjayI+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1MCIgeD0iMjc0IiB5PSI3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjc0IiB4Mj0iMzI0IiB5MT0iMzMuMjk2OSIgeTI9IjMzLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOCIgeD0iMjg1IiB5PSIyNC45OTUxIj7miZPljIU8L3RleHQ+PC9nPjxnIGlkPSJzZW5kZXIiPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTAiIHg9IjM1OSIgeT0iNyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM1OSIgeDI9IjQwOSIgeTE9IjMzLjI5NjkiIHkyPSIzMy4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjgiIHg9IjM3MCIgeT0iMjQuOTk1MSI+5Y+R6YCBPC90ZXh0PjwvZz48IS0tTUQ1PVs0M2NmN2Y2NzdjZDc0OWY1YTU1NTdmNDczYTc3OTg1YV0KbGluayBjb2xsZWN0IHRvIHByZXByb2Nlc3MtLT48ZyBpZD0ibGlua19jb2xsZWN0X3ByZXByb2Nlc3MiPjxwYXRoIGQ9Ik01Ny4yMzgzLDMyIEM2Ny4wODIxLDMyIDc2LjkyNTksMzIgODYuNzY5NiwzMiAiIGZpbGw9Im5vbmUiIGlkPSJjb2xsZWN0LXRvLXByZXByb2Nlc3MiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTEuOTE3MywzMiw4Mi45MTczLDI4LDg2LjkxNzMsMzIsODIuOTE3MywzNiw5MS45MTczLDMyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLU1ENT1bNGQ2ZjA1MzIyMjcyNTZhMTJiODhjMTZmNWMwMzZiNWJdCmxpbmsgcHJlcHJvY2VzcyB0byBlbmNvZGUtLT48ZyBpZD0ibGlua19wcmVwcm9jZXNzX2VuY29kZSI+PHBhdGggZD0iTTE1NC4yODEsMzIgQzE2NC4wODEsMzIgMTczLjg4MSwzMiAxODMuNjgxLDMyICIgZmlsbD0ibm9uZSIgaWQ9InByZXByb2Nlc3MtdG8tZW5jb2RlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE4OC44MDYsMzIsMTc5LjgwNiwyOCwxODMuODA2LDMyLDE3OS44MDYsMzYsMTg4LjgwNiwzMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1NRDU9WzE1Y2Y2MDJkYTkwZDE2MTA5ZTdlZTcxZTJmZGNjYWFjXQpsaW5rIGVuY29kZSB0byBwYWNrLS0+PGcgaWQ9ImxpbmtfZW5jb2RlX3BhY2siPjxwYXRoIGQ9Ik0yMzkuMjM0LDMyIEMyNDkuMDQyLDMyIDI1OC44NSwzMiAyNjguNjU4LDMyICIgZmlsbD0ibm9uZSIgaWQ9ImVuY29kZS10by1wYWNrIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI3My43ODYsMzIsMjY0Ljc4NiwyOCwyNjguNzg2LDMyLDI2NC43ODYsMzYsMjczLjc4NiwzMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1NRDU9WzE0YTk5NWM1YTYyZDk0ODQxZmVmNDgxZGYxYjI4MmQ1XQpsaW5rIHBhY2sgdG8gc2VuZGVyLS0+PGcgaWQ9ImxpbmtfcGFja19zZW5kZXIiPjxwYXRoIGQ9Ik0zMjQuMjM0LDMyIEMzMzQuMDQyLDMyIDM0My44NSwzMiAzNTMuNjU4LDMyICIgZmlsbD0ibm9uZSIgaWQ9InBhY2stdG8tc2VuZGVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM1OC43ODYsMzIsMzQ5Ljc4NiwyOCwzNTMuNzg2LDMyLDM0OS43ODYsMzYsMzU4Ljc4NiwzMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1NRDU9WzMwOWFhYzJkYjY0YzUxNDkxODhhNTgwYTM2ZDBhOWFjXQpAc3RhcnR1bWwNCnNraW5wYXJhbSBTdGF0ZUJhY2tncm91bmRDb2xvciB3aGl0ZQ0KDQpzdGF0ZSAi6YeH6ZuGIiBhcyBjb2xsZWN0DQpzdGF0ZSAi5YmN5aSE55CGIiBhcyBwcmVwcm9jZXNzDQpzdGF0ZSAi57yW56CBIiBhcyBlbmNvZGUNCnN0YXRlICLmiZPljIUiIGFzIHBhY2sNCnN0YXRlICLlj5HpgIEiIGFzIHNlbmRlcg0KDQpjb2xsZWN0IC0+IHByZXByb2Nlc3MNCnByZXByb2Nlc3MgLT4gZW5jb2RlDQplbmNvZGUgLT4gcGFjaw0KcGFjayAtPiBzZW5kZXINCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMi4xMGJldGEyKFVua25vd24gY29tcGlsZSB0aW1lKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogSmF2YShUTSkgU0UgUnVudGltZSBFbnZpcm9ubWVudApKVk06IEphdmEgSG90U3BvdChUTSkgNjQtQml0IFNlcnZlciBWTQpEZWZhdWx0IEVuY29kaW5nOiBVVEYtOApMYW5ndWFnZTogZW4KQ291bnRyeTogVVMKLS0+PC9nPjwvc3ZnPg=='>

<p><code>前处理</code> 包括缩放、图像增强、美颜。<br><code>编码</code> 包括码控、预测、变换、量化、熵编码。<br>在 RTP 打包的时候是以 Slice 为单位 <code>打包</code> 的，而不是以帧为单位打包的。Slice 其实是为了并行编码设计的。将一帧图像划分成几个 Slice，并且 Slice 之间相互独立、互不依赖、独立编码。</p>
<p>在RTC视频通话场景下最好选择 <code>CBR</code> 的码控算法，从而保证输出码率能够比较好地贴合预估带宽。<br>如果编码器输出码率差网络带宽太多，也会导致 <code>PacedSender</code> 缓冲太多数据包，从而引起延时太长。码控和 PacedSender 都很重要，它们是一起协作来减少卡顿的。</p>
<h3 id="接收端"><a href="#接收端" class="headerlink" title="接收端"></a>接收端</h3><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI2M3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjkycHg7aGVpZ2h0OjYzcHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNjkyIDYzIiB3aWR0aD0iNjkycHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48ZyBpZD0icmVjZWl2ZXIiPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTAiIHg9IjciIHk9IjciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI3IiB4Mj0iNTciIHkxPSIzMy4yOTY5IiB5Mj0iMzMuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSIxOCIgeT0iMjQuOTk1MSI+5pS25YyFPC90ZXh0PjwvZz48ZyBpZD0iaml0dGVyYnVmZmVyIj48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjUwIiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI5MSIgeD0iOTIuNSIgeT0iNyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjkyLjUiIHgyPSIzODMuNSIgeTE9IjMzLjI5NjkiIHkyPSIzMy4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcxIiB4PSIxMDIuNSIgeT0iMjQuOTk1MSI+aml0dGVyYnVmZmVyKOe7hOW4pyvliKTmlq3ov57nu63mgKflkozlj6/op6PnoIHmgKcpPC90ZXh0PjwvZz48ZyBpZD0iZGVjb2RlIj48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjUwIiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjUwIiB4PSI0MTkiIHk9IjciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0MTkiIHgyPSI0NjkiIHkxPSIzMy4yOTY5IiB5Mj0iMzMuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSI0MzAiIHk9IjI0Ljk5NTEiPuino+eggTwvdGV4dD48L2c+PGcgaWQ9ImNvbnZlcnQiPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTYiIHg9IjUwNCIgeT0iNyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjUwNCIgeDI9IjYwMCIgeTE9IjMzLjI5NjkiIHkyPSIzMy4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzYiIHg9IjUxNCIgeT0iMjQuOTk1MSI+WVVWLSZndDtSR0I8L3RleHQ+PC9nPjxnIGlkPSJyZW5kZXIiPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTAiIHg9IjYzNSIgeT0iNyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjYzNSIgeDI9IjY4NSIgeTE9IjMzLjI5NjkiIHkyPSIzMy4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjgiIHg9IjY0NiIgeT0iMjQuOTk1MSI+5riy5p+TPC90ZXh0PjwvZz48IS0tTUQ1PVs2Njc5YzdjZGNlMzc2M2YyYjI4ZmQ5ZDFmZDcwZTI3NF0KbGluayByZWNlaXZlciB0byBqaXR0ZXJidWZmZXItLT48ZyBpZD0ibGlua19yZWNlaXZlcl9qaXR0ZXJidWZmZXIiPjxwYXRoIGQ9Ik01Ny4zNDc3LDMyIEM2Ny4yNjI5LDMyIDc3LjE3ODIsMzIgODcuMDkzNCwzMiAiIGZpbGw9Im5vbmUiIGlkPSJyZWNlaXZlci10by1qaXR0ZXJidWZmZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTIuMjc4NSwzMiw4My4yNzg1LDI4LDg3LjI3ODUsMzIsODMuMjc4NSwzNiw5Mi4yNzg1LDMyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLU1ENT1bMGMzMmQ4NTRhYmJlNTk1MDc0NGFmOTc2MmFiMDlhMWFdCmxpbmsgaml0dGVyYnVmZmVyIHRvIGRlY29kZS0tPjxnIGlkPSJsaW5rX2ppdHRlcmJ1ZmZlcl9kZWNvZGUiPjxwYXRoIGQ9Ik0zODMuNjQ4LDMyIEMzOTMuNTUyLDMyIDQwMy40NTYsMzIgNDEzLjM2LDMyICIgZmlsbD0ibm9uZSIgaWQ9ImppdHRlcmJ1ZmZlci10by1kZWNvZGUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDE4LjUzOSwzMiw0MDkuNTM5LDI4LDQxMy41MzksMzIsNDA5LjUzOSwzNiw0MTguNTM5LDMyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLU1ENT1bODdlNDBiOTMwNzBmNjIyOTQzN2EzYjQ1ODk4OTRmMWFdCmxpbmsgZGVjb2RlIHRvIGNvbnZlcnQtLT48ZyBpZD0ibGlua19kZWNvZGVfY29udmVydCI+PHBhdGggZD0iTTQ2OS4zMTIsMzIgQzQ3OS4xMjMsMzIgNDg4LjkzMywzMiA0OTguNzQzLDMyICIgZmlsbD0ibm9uZSIgaWQ9ImRlY29kZS10by1jb252ZXJ0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUwMy44NzMsMzIsNDk0Ljg3MywyOCw0OTguODczLDMyLDQ5NC44NzMsMzYsNTAzLjg3MywzMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1NRDU9W2Q0MzUxZjBiZmQ0NzQ1OWRjZjg3MTc4MzIxNmRiYWZlXQpsaW5rIGNvbnZlcnQgdG8gcmVuZGVyLS0+PGcgaWQ9ImxpbmtfY29udmVydF9yZW5kZXIiPjxwYXRoIGQ9Ik02MDAuMDk0LDMyIEM2MDkuOTI1LDMyIDYxOS43NTUsMzIgNjI5LjU4NiwzMiAiIGZpbGw9Im5vbmUiIGlkPSJjb252ZXJ0LXRvLXJlbmRlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2MzQuNzI3LDMyLDYyNS43MjcsMjgsNjI5LjcyNywzMiw2MjUuNzI3LDM2LDYzNC43MjcsMzIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tTUQ1PVs3MWIxMTc5MDE2MTQzYTZkYWRmMTNhZmQ1YzcxNWIyY10KQHN0YXJ0dW1sDQpza2lucGFyYW0gU3RhdGVCYWNrZ3JvdW5kQ29sb3Igd2hpdGUNCg0Kc3RhdGUgIuaUtuWMhSIgYXMgcmVjZWl2ZXINCnN0YXRlICJqaXR0ZXJidWZmZXIo57uE5binK+WIpOaWrei/nue7reaAp+WSjOWPr+ino+eggeaApykiIGFzIGppdHRlcmJ1ZmZlcg0Kc3RhdGUgIuino+eggSIgYXMgZGVjb2RlDQpzdGF0ZSAiWVVWLT5SR0IiIGFzIGNvbnZlcnQNCnN0YXRlICLmuLLmn5MiIGFzIHJlbmRlcg0KDQpyZWNlaXZlciAtPiBqaXR0ZXJidWZmZXINCmppdHRlcmJ1ZmZlciAtPiBkZWNvZGUNCmRlY29kZSAtPiBjb252ZXJ0DQpjb252ZXJ0IC0+IHJlbmRlcg0KQGVuZHVtbA0KClBsYW50VU1MIHZlcnNpb24gMS4yMDIyLjEwYmV0YTIoVW5rbm93biBjb21waWxlIHRpbWUpCihHUEwgc291cmNlIGRpc3RyaWJ1dGlvbikKSmF2YSBSdW50aW1lOiBKYXZhKFRNKSBTRSBSdW50aW1lIEVudmlyb25tZW50CkpWTTogSmF2YSBIb3RTcG90KFRNKSA2NC1CaXQgU2VydmVyIFZNCkRlZmF1bHQgRW5jb2Rpbmc6IFVURi04Ckxhbmd1YWdlOiBlbgpDb3VudHJ5OiBVUwotLT48L2c+PC9zdmc+'>

<p><code>Jitter Buffer</code>工作在接收端，主要功能就是在接收端收到包之后进行组帧，并判断帧的完整性、可解码性、发送丢包重传请求、发送关键帧请求以及估算网络抖动的。</p>
<h4 id="判断帧完整性"><a href="#判断帧完整性" class="headerlink" title="判断帧完整性"></a>判断帧完整性</h4><p>结合发送端的打包特性：</p>
<ul>
<li>在 RTP 打包的时候是以 Slice 为单位打包的，一帧是有可能有多个 Slice 的。</li>
<li>在 RTP 包里面，RTP 头有一个标志位 M，表示是一帧的结尾。因此只要收到这个标志位为 1 的包就代表收到了这一帧的最后一个包。</li>
<li>同一帧 RTP 序列号一直连续。</li>
<li>同一帧 RTP 时间戳相同。</li>
<li>slice_header 的 first_mb_in_slice 字段为 0，就代表是帧的第一个 Slice 了。</li>
</ul>
<p>方法一：<br>first_mb_in_slice 为0，序号连续，找到 M 为1的包。</p>
<p>方法二：<br>收包队列从 M 为1向前找序号连续的，直到找到RTP时间戳跳变为止为帧开头。</p>
<p>两种方法相同的都是用M标志位判断帧结尾，区别是如何找帧的开头。第一种方法更加灵活。</p>
<h3 id="卡顿"><a href="#卡顿" class="headerlink" title="卡顿"></a>卡顿</h3><p>一般的通话视频来说，帧之间间隔超过200ms会造成视觉卡顿。</p>
<h4 id="发送端排查"><a href="#发送端排查" class="headerlink" title="发送端排查"></a>发送端排查</h4><ul>
<li>帧率不够5fps，提高帧率。</li>
<li>机器性能不够，导致前处理或编码耗时过长。可以在高分辨率的时候尽量使用 GPU 做前处理，并使用硬件编码或者将软件编码设置为快速档加快处理的速度（压缩率会下降）。</li>
<li>编码器输出码率超过实际网络带宽。如果使用 VBR 码控算法，编码器的输出码率会随着画面的复杂程度变化，那就会有很大的概率因为画面复杂而出现输出码率超过预估带宽的情况，从而导致对端出现严重的卡顿。而 CBR 码控算法是你设置多少目标码率，编码器的输出码率就会接近于目标码率。</li>
<li>复杂帧编码后过大或者 I 帧比较大。为了能够减小这种大帧带来的瞬时网络波动，我们可以在编码打包之后、发送之前，加一个平滑发送的模块来平滑地发送视频包。这个模块在 WebRTC 中叫做 PacedSender（节奏发送器）。PacedSender 主要的工作原理就是编码输出的码流打包之后先放到它的缓冲区中，而不是直接发送。之后它再按照预估带宽大小对应的发送速度，将缓冲区中的数据发送到网络当中。</li>
</ul>
<h4 id="接收端排查"><a href="#接收端排查" class="headerlink" title="接收端排查"></a>接收端排查</h4><ul>
<li>丢包重传策略应对网络丢包。</li>
<li>丢包重传仍然没有恢复，FIR请求，收到IDR帧强制关键帧（立即刷新帧）才可恢复。</li>
</ul>
<h3 id="花屏"><a href="#花屏" class="headerlink" title="花屏"></a>花屏</h3><p>基本上都是接收端的问题：</p>
<ul>
<li>帧不完整。如果帧出现了丢包就送去解码的话，若能解码成功，那肯定会出现解码花屏的问题。</li>
<li>参考帧不完整。</li>
<li>渲染的时候 YUV 格式弄错了。</li>
<li>Stride 问题会造成花屏。我们解码后渲染前一定要处理好 YUV 的 Stride 问题，不要和宽度弄混了。</li>
</ul>
<p>后两者花屏的图像比较有辨识度。</p>
]]></content>
      <categories>
        <category>media</category>
      </categories>
  </entry>
  <entry>
    <title>HttpLongPolling</title>
    <url>/2021/05/08/2021-05-09-http-long-polling/</url>
    <content><![CDATA[<h3 id="HTTP推送技术-Push-technology"><a href="#HTTP推送技术-Push-technology" class="headerlink" title="HTTP推送技术 Push technology"></a>HTTP推送技术 Push technology</h3><p>传统的HTTP请求都是client主动发起到server的请求，若server有通知需要即时通知client时，需要推送技术。</p>
<h4 id="常规轮询-Regular-Polling"><a href="#常规轮询-Regular-Polling" class="headerlink" title="常规轮询 Regular Polling"></a>常规轮询 Regular Polling</h4><p>每隔一段时间pull/get消息。</p>
<ul>
<li>没有消息时浪费资源。</li>
<li>有消息时不能即时推送。</li>
</ul>
<h4 id="长轮询-Long-Polling"><a href="#长轮询-Long-Polling" class="headerlink" title="长轮询 Long Polling"></a>长轮询 Long Polling</h4><ol>
<li><p>请求</p>
<p>client发起请求并把keepalive时间设的较长，服务器收到消息并不立即返回，而是hold一段时间。</p>
</li>
<li><p>响应</p>
<p>当有消息推送时，server立即返回消息。或server的connection hang timeout时，返回消息。server返回消息后，将连接关闭。</p>
</li>
<li><p>循环</p>
<p> client收到response后，应立即再次发起请求。</p>
</li>
</ol>
<h3 id="Long-Polling-vs-Websocket"><a href="#Long-Polling-vs-Websocket" class="headerlink" title="Long Polling vs Websocket"></a>Long Polling vs Websocket</h3><p>Long Polling并不是一种全新的协议，而是基于XMLHttpRequest实现了一种推送机制。最大的优点是过渡期的兼容性好，client无需新增协议，容易适配。<br>同个client若发起多个request连接，消息只返回一次，应通过本地缓存共享推送消息。</p>
<p>websocket协议相对较晚出现，需要client和server端都支持websocket协议，尽管它的握手还是基于HTTP协议，但它在HTTP协议上实现了全双工通信。</p>
<p>websocket几乎解决了Long Polling的所有缺点，只是被断开后不能自恢复。</p>
<h3 id="Apollo在Long-polling的实践"><a href="#Apollo在Long-polling的实践" class="headerlink" title="Apollo在Long polling的实践"></a>Apollo在Long polling的实践</h3><p>Apollo是携程开源的配置中心，提供了带缓存和不带缓存的pull接口，和long polling即时变更推送接口。</p>
<p>为了避免long polling机制的缺陷，使用了版本号等方案。</p>
<ul>
<li><p>Long polling获取的消息时，需要带上本地缓存的notificationId，server端判断client带过来的notificationId是否为最新，若需要更新则立即返回消息，否则等配置有更新才会返回，返回消息携带notificationId，client端更新缓存。这样做的好处是，即使中间断开连接，恢复连接后也可以对比本地是否需要更新配置信息。</p>
</li>
<li><p>client使用pull接口获取配置时，可填参数IP表示client的唯一Id，当需要灰度推送时，根据client携带的IP判断是否给它灰度配置。这样做的好处是，使用逻辑上的Id（IP），相同IP的client可以获取到相同的配置。</p>
</li>
<li><p>client使用pull接口获取配置时，可填参数releaseKey。Apollo每次发布配置时，会为新版本的配置生成releaseKey，使用常规轮询时server端无需每次都查表，可根据releaseKey判断是否需要读取配置。client也无需每次都更新本地缓存的配置。</p>
</li>
</ul>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI1ODRweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjY4MnB4O2hlaWdodDo1ODRweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA2ODIgNTg0IiB3aWR0aD0iNjgycHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48ZWxsaXBzZSBjeD0iNDExLjM3NSIgY3k9IjIwIiBmaWxsPSIjMjIyMjIyIiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIzMjEuODc1LDEwMy45Njg4LDUwMC44NzUsMTAzLjk2ODgsNTEyLjg3NSwxMTUuOTY4OCw1MDAuODc1LDEyNy45Njg4LDMyMS44NzUsMTI3Ljk2ODgsMzA5Ljg3NSwxMTUuOTY4OCwzMjEuODc1LDEwMy45Njg4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzkiIHg9IjMyMS44NzUiIHk9IjExOS43NzY5Ij5BcG9sbG8gY29uZmlnIG5vcm1hbCByZXNwb25zZT88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjEiIHg9IjI4OC44NzUiIHk9IjExMy4zNzQ1Ij55ZXM8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQiIHg9IjUxMi44NzUiIHk9IjExMy4zNzQ1Ij5ubzwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjIwOC4yNSwxMzcuOTY4OCwzMDYuMjUsMTM3Ljk2ODgsMzE4LjI1LDE0OS45Njg4LDMwNi4yNSwxNjEuOTY4OCwyMDguMjUsMTYxLjk2ODgsMTk2LjI1LDE0OS45Njg4LDIwOC4yNSwxMzcuOTY4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTgiIHg9IjIwOC4yNSIgeT0iMTUzLjc3NjkiPmh0dHAgc3RhdHVzIGNvZGU/PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDYiIHg9IjEwNC41IiB5PSIxOTcuNTc4MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMiIgeD0iMTE4LjUiIHk9IjIxOC43MTY4Ij51cGRhdGUgbm90aWZpY2F0aW9uSWQ8L3RleHQ+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIxMDcsMjUxLjU0NjksMjQ4LDI1MS41NDY5LDI2MCwyNjMuNTQ2OSwyNDgsMjc1LjU0NjksMTA3LDI3NS41NDY5LDk1LDI2My41NDY5LDEwNywyNTEuNTQ2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQxIiB4PSIxMDciIHk9IjI2Ny4zNTUiPkhUVFAgZ2V0IGNvbmZpZyBuZXdlc3Q/PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzgiIHg9IjExIiB5PSIzMTguMzUxNiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNCIgeD0iMjUiIHk9IjMzOS40OTAyIj51cGRhdGUgbG9jYWwgY2FjaGU8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg3IiB4PSIyMzEuNSIgeT0iMzE4LjM1MTYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MyIgeD0iMjQ1LjUiIHk9IjMzOS40OTAyIj5ubyBjaGFuZ2U8L3RleHQ+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIxNzcuNSwzOTkuMjQyMiwxNzcuNSwzOTkuMjQyMiwxODkuNSw0MTEuMjQyMiwxNzcuNSw0MjMuMjQyMiwxNzcuNSw0MjMuMjQyMiwxNjUuNSw0MTEuMjQyMiwxNzcuNSwzOTkuMjQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg3IiB4PSIzMzguNSIgeT0iMTk3LjU3ODEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MyIgeD0iMzUyLjUiIHk9IjIxOC43MTY4Ij5ubyBjaGFuZ2U8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjU2IiB4PSI0NDUuNSIgeT0iMTk3LjU3ODEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMiIgeD0iNDU5LjUiIHk9IjIxOC43MTY4Ij5vdGhlcjwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjI1Ny4yNSw0MzMuMjQyMiwyNTcuMjUsNDMzLjI0MjIsMjY5LjI1LDQ0NS4yNDIyLDI1Ny4yNSw0NTcuMjQyMiwyNTcuMjUsNDU3LjI0MjIsMjQ1LjI1LDQ0NS4yNDIyLDI1Ny4yNSw0MzMuMjQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg0IiB4PSI1MjMuNSIgeT0iMTM3Ljk2ODgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MCIgeD0iNTM3LjUiIHk9IjE1OS4xMDc0Ij5IdHRwIGVycm9yPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iNDExLjM3NSw0NjMuMjQyMiw0MjMuMzc1LDQ3NS4yNDIyLDQxMS4zNzUsNDg3LjI0MjIsMzk5LjM3NSw0NzUuMjQyMiw0MTEuMzc1LDQ2My4yNDIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODciIHg9IjM2Ny44NzUiIHk9IjUwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjciIHg9IjM3Ny44NzUiIHk9IjcxLjEzODciPkxvbmdQb2xsaW5nPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iNDExLjM3NSw1MDcuMjQyMiw0MTEuMzc1LDUwNy4yNDIyLDQyMy4zNzUsNTE5LjI0MjIsNDExLjM3NSw1MzEuMjQyMiw0MTEuMzc1LDUzMS4yNDIyLDM5OS4zNzUsNTE5LjI0MjIsNDExLjM3NSw1MDcuMjQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjU0IiB4PSI2MTcuNSIgeT0iMzQ1LjI3MzQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNCIgeD0iNjI3LjUiIHk9IjM2Ni40MTIxIj5zbGVlcDwvdGV4dD48ZWxsaXBzZSBjeD0iNDExLjM3NSIgY3k9IjU2Mi4yNDIyIiBmaWxsPSJub25lIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxLjA7Ii8+PGVsbGlwc2UgY3g9IjQxMS4zNzUiIGN5PSI1NjIuMjQyMiIgZmlsbD0iIzIyMjIyMiIgcng9IjYiIHJ5PSI2IiBzdHlsZT0ic3Ryb2tlOiMxMTExMTE7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI5NSIgeDI9IjgwIiB5MT0iMjYzLjU0NjkiIHkyPSIyNjMuNTQ2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjgwIiB4Mj0iODAiIHkxPSIyNjMuNTQ2OSIgeTI9IjMxOC4zNTE2Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3NiwzMDguMzUxNiw4MCwzMTguMzUxNiw4NCwzMDguMzUxNiw4MCwzMTIuMzUxNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjEiIHg9IjgwIiB5PSIyOTYuODUxNiI+MjAwPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjI2MCIgeDI9IjI3NSIgeTE9IjI2My41NDY5IiB5Mj0iMjYzLjU0NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyNzUiIHgyPSIyNzUiIHkxPSIyNjMuNTQ2OSIgeTI9IjMxOC4zNTE2Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNzEsMzA4LjM1MTYsMjc1LDMxOC4zNTE2LDI3OSwzMDguMzUxNiwyNzUsMzEyLjM1MTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxIiB4PSIyNzUiIHk9IjI5Ni44NTE2Ij4zMDQ8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iODAiIHgyPSI4MCIgeTE9IjM1Mi4zMjAzIiB5Mj0iNDExLjI0MjIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI4MCIgeDI9IjE2NS41IiB5MT0iNDExLjI0MjIiIHkyPSI0MTEuMjQyMiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTU1LjUsNDA3LjI0MjIsMTY1LjUsNDExLjI0MjIsMTU1LjUsNDE1LjI0MjIsMTU5LjUsNDExLjI0MjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjI3NSIgeDI9IjI3NSIgeTE9IjM1Mi4zMjAzIiB5Mj0iNDExLjI0MjIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyNzUiIHgyPSIxODkuNSIgeTE9IjQxMS4yNDIyIiB5Mj0iNDExLjI0MjIiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE5OS41LDQwNy4yNDIyLDE4OS41LDQxMS4yNDIyLDE5OS41LDQxNS4yNDIyLDE5NS41LDQxMS4yNDIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNzcuNSIgeDI9IjE3Ny41IiB5MT0iMjMxLjU0NjkiIHkyPSIyNTEuNTQ2OSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTczLjUsMjQxLjU0NjksMTc3LjUsMjUxLjU0NjksMTgxLjUsMjQxLjU0NjksMTc3LjUsMjQ1LjU0NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE5Ni4yNSIgeDI9IjE3Ny41IiB5MT0iMTQ5Ljk2ODgiIHkyPSIxNDkuOTY4OCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE3Ny41IiB4Mj0iMTc3LjUiIHkxPSIxNDkuOTY4OCIgeTI9IjE5Ny41NzgxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNzMuNSwxODcuNTc4MSwxNzcuNSwxOTcuNTc4MSwxODEuNSwxODcuNTc4MSwxNzcuNSwxOTEuNTc4MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjEiIHg9IjE3Ny41IiB5PSIxNzcuNTgxNSI+MjAwPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjMxOC4yNSIgeDI9IjQ3My41IiB5MT0iMTQ5Ljk2ODgiIHkyPSIxNDkuOTY4OCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjQ3My41IiB4Mj0iNDczLjUiIHkxPSIxNDkuOTY4OCIgeTI9IjE5Ny41NzgxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NjkuNSwxODcuNTc4MSw0NzMuNSwxOTcuNTc4MSw0NzcuNSwxODcuNTc4MSw0NzMuNSwxOTEuNTc4MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzAiIHg9IjQ3My41IiB5PSIxNzcuNTgxNSI+b3RoZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzgyIiB4Mj0iMzgyIiB5MT0iMTQ5Ljk2ODgiIHkyPSIxOTcuNTc4MSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzc4LDE4Ny41NzgxLDM4MiwxOTcuNTc4MSwzODYsMTg3LjU3ODEsMzgyLDE5MS41NzgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMSIgeD0iMzgyIiB5PSIxNzIuNTgxNSI+MzA0PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE3Ny41IiB4Mj0iMTc3LjUiIHkxPSI0MjMuMjQyMiIgeTI9IjQ0NS4yNDIyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTc3LjUiIHgyPSIyNDUuMjUiIHkxPSI0NDUuMjQyMiIgeTI9IjQ0NS4yNDIyIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMzUuMjUsNDQxLjI0MjIsMjQ1LjI1LDQ0NS4yNDIyLDIzNS4yNSw0NDkuMjQyMiwyMzkuMjUsNDQ1LjI0MjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjQ3My41IiB4Mj0iNDczLjUiIHkxPSIyMzEuNTQ2OSIgeTI9IjQ0NS4yNDIyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDczLjUiIHgyPSIyNjkuMjUiIHkxPSI0NDUuMjQyMiIgeTI9IjQ0NS4yNDIyIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNzkuMjUsNDQxLjI0MjIsMjY5LjI1LDQ0NS4yNDIyLDI3OS4yNSw0NDkuMjQyMiwyNzUuMjUsNDQ1LjI0MjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM4MiIgeDI9IjM4MiIgeTE9IjIzMS41NDY5IiB5Mj0iNDQ1LjI0MjIiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM3OCw0MzUuMjQyMiwzODIsNDQ1LjI0MjIsMzg2LDQzNS4yNDIyLDM4Miw0MzkuMjQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzA5Ljg3NSIgeDI9IjI1Ny4yNSIgeTE9IjExNS45Njg4IiB5Mj0iMTE1Ljk2ODgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyNTcuMjUiIHgyPSIyNTcuMjUiIHkxPSIxMTUuOTY4OCIgeTI9IjEzNy45Njg4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNTMuMjUsMTI3Ljk2ODgsMjU3LjI1LDEzNy45Njg4LDI2MS4yNSwxMjcuOTY4OCwyNTcuMjUsMTMxLjk2ODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjUxMi44NzUiIHgyPSI1NjUuNSIgeTE9IjExNS45Njg4IiB5Mj0iMTE1Ljk2ODgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI1NjUuNSIgeDI9IjU2NS41IiB5MT0iMTE1Ljk2ODgiIHkyPSIxMzcuOTY4OCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTYxLjUsMTI3Ljk2ODgsNTY1LjUsMTM3Ljk2ODgsNTY5LjUsMTI3Ljk2ODgsNTY1LjUsMTMxLjk2ODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjI1Ny4yNSIgeDI9IjI1Ny4yNSIgeTE9IjQ1Ny4yNDIyIiB5Mj0iNDc1LjI0MjIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyNTcuMjUiIHgyPSIzOTkuMzc1IiB5MT0iNDc1LjI0MjIiIHkyPSI0NzUuMjQyMiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzg5LjM3NSw0NzEuMjQyMiwzOTkuMzc1LDQ3NS4yNDIyLDM4OS4zNzUsNDc5LjI0MjIsMzkzLjM3NSw0NzUuMjQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTY1LjUiIHgyPSI1NjUuNSIgeTE9IjE3MS45Mzc1IiB5Mj0iNDc1LjI0MjIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI1NjUuNSIgeDI9IjQyMy4zNzUiIHkxPSI0NzUuMjQyMiIgeTI9IjQ3NS4yNDIyIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MzMuMzc1LDQ3MS4yNDIyLDQyMy4zNzUsNDc1LjI0MjIsNDMzLjM3NSw0NzkuMjQyMiw0MjkuMzc1LDQ3NS4yNDIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0MTEuMzc1IiB4Mj0iNDExLjM3NSIgeTE9IjgzLjk2ODgiIHkyPSIxMDMuOTY4OCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDA3LjM3NSw5My45Njg4LDQxMS4zNzUsMTAzLjk2ODgsNDE1LjM3NSw5My45Njg4LDQxMS4zNzUsOTcuOTY4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDIzLjM3NSIgeDI9IjY0NC41IiB5MT0iNTE5LjI0MjIiIHkyPSI1MTkuMjQyMiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjY0NC41IiB4Mj0iNjQ0LjUiIHkxPSIzNzkuMjQyMiIgeTI9IjUxOS4yNDIyIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NDAuNSwzODkuMjQyMiw2NDQuNSwzNzkuMjQyMiw2NDguNSwzODkuMjQyMiw2NDQuNSwzODUuMjQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNjQ0LjUiIHgyPSI2NDQuNSIgeTE9IjY2Ljk4NDQiIHkyPSIzNDUuMjczNCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjY0NC41IiB4Mj0iNDU0Ljg3NSIgeTE9IjY2Ljk4NDQiIHkyPSI2Ni45ODQ0Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NjQuODc1LDYyLjk4NDQsNDU0Ljg3NSw2Ni45ODQ0LDQ2NC44NzUsNzAuOTg0NCw0NjAuODc1LDY2Ljk4NDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjQxMS4zNzUiIHgyPSI0MTEuMzc1IiB5MT0iNDg3LjI0MjIiIHkyPSI1MDcuMjQyMiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDA3LjM3NSw0OTcuMjQyMiw0MTEuMzc1LDUwNy4yNDIyLDQxNS4zNzUsNDk3LjI0MjIsNDExLjM3NSw1MDEuMjQyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDExLjM3NSIgeDI9IjQxMS4zNzUiIHkxPSIzMCIgeTI9IjUwIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MDcuMzc1LDQwLDQxMS4zNzUsNTAsNDE1LjM3NSw0MCw0MTEuMzc1LDQ0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0MTEuMzc1IiB4Mj0iNDExLjM3NSIgeTE9IjUzMS4yNDIyIiB5Mj0iNTUxLjI0MjIiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQwNy4zNzUsNTQxLjI0MjIsNDExLjM3NSw1NTEuMjQyMiw0MTUuMzc1LDU0MS4yNDIyLDQxMS4zNzUsNTQ1LjI0MjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwhLS1NRDU9WzliMDk1MDFmODlkZTE1NmRlNjZjNDRkM2JmNWFmYzM4XQpAc3RhcnR1bWwNCnN0YXJ0IA0KDQpyZXBlYXQgOkxvbmdQb2xsaW5nOw0KaWYgKEFwb2xsbyBjb25maWcgbm9ybWFsIHJlc3BvbnNlPykgdGhlbiAoeWVzKQ0KICAgIHN3aXRjaCAoaHR0cCBzdGF0dXMgY29kZT8pIA0KICAgIGNhc2UgKDIwMCkNCiAgICAgICAgOiB1cGRhdGUgbm90aWZpY2F0aW9uSWQ7DQogICAgICAgIHN3aXRjaCAoSFRUUCBnZXQgY29uZmlnIG5ld2VzdD8pDQogICAgICAgICAgICBjYXNlICgyMDApDQogICAgICAgICAgICAgICAgOiB1cGRhdGUgbG9jYWwgY2FjaGU7DQogICAgICAgICAgICBjYXNlICgzMDQpDQogICAgICAgICAgICAgICAgOiBubyBjaGFuZ2U7DQogICAgICAgIGVuZHN3aXRjaA0KICAgIGNhc2UgKDMwNCkNCiAgICAgICAgOiBubyBjaGFuZ2U7DQogICAgY2FzZSAob3RoZXIpDQogICAgICAgIDogb3RoZXI7DQogICAgZW5kc3dpdGNoDQplbHNlIChubykNCiAgICA6IEh0dHAgZXJyb3I7DQplbmRpZg0KDQpiYWNrd2FyZCA6c2xlZXA7DQpyZXBlYXQgd2hpbGUgKCkNCnN0b3ANCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMi4xMGJldGEyKFVua25vd24gY29tcGlsZSB0aW1lKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogSmF2YShUTSkgU0UgUnVudGltZSBFbnZpcm9ubWVudApKVk06IEphdmEgSG90U3BvdChUTSkgNjQtQml0IFNlcnZlciBWTQpEZWZhdWx0IEVuY29kaW5nOiBVVEYtOApMYW5ndWFnZTogZW4KQ291bnRyeTogVVMKLS0+PC9nPjwvc3ZnPg=='>

<ul>
<li><p>流程图不需要考虑很严谨的逻辑，因为有版本号，即使中间有异常，下次轮询的时候也可以恢复。</p>
</li>
<li><p>做好降级策略，定期轮询，防止路由策略等导致的long polling服务不可用。</p>
</li>
</ul>
<h3 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h3><p><a href="https://ably.com/blog/websockets-vs-long-polling">https://ably.com/blog/websockets-vs-long-polling</a></p>
]]></content>
      <categories>
        <category>protocol</category>
      </categories>
  </entry>
  <entry>
    <title>Pion</title>
    <url>/2021/09/17/2021-09-18-pion/</url>
    <content><![CDATA[<h1 id="Pion是什么"><a href="#Pion是什么" class="headerlink" title="Pion是什么"></a>Pion是什么</h1><p>golang实现的webrtc。</p>
<h2 id="webrtc-peerconnection"><a href="#webrtc-peerconnection" class="headerlink" title="webrtc peerconnection"></a>webrtc peerconnection</h2><p>webrtc里最基本的模块就是peerconnection，代码里经常缩写成pc。</p>
<p>peerconnection对外提供的接口有一部分是On开头的，用于在peerconnection内部发生某事件的回调接口。</p>
<p>使用默认配置新建pc</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line">pc, err := webrtc.NewPeerConnection(config)</span><br></pre></td></tr></table></figure>

<p>或使用自定义配置新建pc</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line">peerConnection, err := webrtc.NewAPI(webrtc.WithMediaEngine(m), webrtc.WithInterceptorRegistry(i)).NewPeerConnection(config)</span><br></pre></td></tr></table></figure>

<p>NewAPI接口设计使用<code>Function Option</code>的编程模式，扩展性好。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webrtc可自定义的引擎和调用链，都定义为私有，只能在初始化时从外部指定</span></span><br><span class="line"><span class="keyword">type</span> API <span class="keyword">struct</span> &#123;</span><br><span class="line">	settingEngine       *SettingEngine <span class="comment">// 和ICE，NAT，DTLS等相关的功能，几乎都是标准流程，可定制化的内容很少</span></span><br><span class="line">	mediaEngine         *MediaEngine <span class="comment">// 和pc能力相关的参数，比如codec，extension等</span></span><br><span class="line">	interceptorRegistry *interceptor.Registry <span class="comment">// 和RTP/RTCP包处理相关的功能，比如JitterBuffer，NACK，TWCC等</span></span><br><span class="line"></span><br><span class="line">	interceptor interceptor.Interceptor <span class="comment">// Generated per PeerConnection</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 对外初始化接口，可灵活扩展</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewAPI</span><span class="params">(options ...<span class="keyword">func</span>(*API)</span>) *<span class="title">API</span></span> &#123;</span><br><span class="line">	a := &amp;API&#123;interceptor: &amp;interceptor.NoOp&#123;&#125;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, o := <span class="keyword">range</span> options &#123;</span><br><span class="line">		o(a)</span><br><span class="line">	&#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 外部可自定义实例化这个成员</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithInterceptorRegistry</span><span class="params">(interceptorRegistry *interceptor.Registry)</span> <span class="title">func</span><span class="params">(a *API)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(a *API)</span></span> &#123;</span><br><span class="line">		a.interceptorRegistry = interceptorRegistry</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TURN"><a href="#TURN" class="headerlink" title="TURN"></a>TURN</h3><p>TURN服务器兼容了STUN服务器的功能，即打洞和中继服务器。</p>
<p>STUN消息类型：</p>
<ul>
<li>Request 0x00</li>
<li>Indication 0x01</li>
<li>Success Response 0x02</li>
<li>Error Response 0x03</li>
</ul>
<p>STUN消息方法：</p>
<ul>
<li>Binding 0x001</li>
<li>Allocate 0x003</li>
<li>Refresh 0x004</li>
<li>Send 0x006</li>
<li>Data 0x007</li>
<li>CreatePermission 0x008</li>
<li>ChannelBind 0x009</li>
</ul>
<p><code>turn server</code>实现了一个<code>allocation manager</code>用于管理已授权的client信息，用作管理client的长效鉴权和分配中继信息。</p>
<h4 id="请求分配中继"><a href="#请求分配中继" class="headerlink" title="请求分配中继"></a>请求分配中继</h4><p>TURN client和server之间可选择UDP，TCP（包括TLS）传输STUN消息，TURN server和peer之间一般是UDP传输DATA。</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIzNzFweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjg5N3B4O2hlaWdodDozNzFweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA4OTcgMzcxIiB3aWR0aD0iODk3cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjMyLjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI0MjkuNSIgeT0iOTQuNTYyNSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMjkuMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjQyOS41IiB5PSIxOTIuOTYwOSIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iODEuMzk4NCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNDEzIiB4PSI2MSIgeT0iNTMuMjk2OSIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iODEuMzk4NCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iODgyIiB4PSI5IiB5PSIxNDguNjk1MyIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNzUuMzk4NCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMjk3IiB4PSIxNzciIHk9IjI0NC4wOTM4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjIxNCIgeDI9IjIxNCIgeTE9IjM2LjI5NjkiIHkyPSIzMzYuNDkyMiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSI0MzQiIHgyPSI0MzQiIHkxPSIzNi4yOTY5IiB5Mj0iMzM2LjQ5MjIiLz48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjU1IiB4PSIxODciIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MSIgeD0iMTk0IiB5PSIyNC45OTUxIj5jbGllbnQ8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1NSIgeD0iMTg3IiB5PSIzMzUuNDkyMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxIiB4PSIxOTQiIHk9IjM1NS40ODczIj5jbGllbnQ8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1OSIgeD0iNDA1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDUiIHg9IjQxMiIgeT0iMjQuOTk1MSI+c2VydmVyPC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTkiIHg9IjQwNSIgeT0iMzM1LjQ5MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NSIgeD0iNDEyIiB5PSIzNTUuNDg3MyI+c2VydmVyPC90ZXh0PjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMzIuMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjQyOS41IiB5PSI5NC41NjI1Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIyOS4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iNDI5LjUiIHk9IjE5Mi45NjA5Ii8+PHBhdGggZD0iTTYxLDUzLjI5NjkgTDIwMSw1My4yOTY5IEwyMDEsNjAuNDI5NyBMMTkxLDcwLjQyOTcgTDYxLDcwLjQyOTcgTDYxLDUzLjI5NjkgIiBmaWxsPSIjRUVFRUVFIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjgxLjM5ODQiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQxMyIgeD0iNjEiIHk9IjUzLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTUiIHg9Ijc2IiB5PSI2Ni4zNjM4Ij5BbGxvY2F0ZSDljL/lkI08L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MTcuNSw5MC41NjI1LDQyNy41LDk0LjU2MjUsNDE3LjUsOTguNTYyNSw0MjEuNSw5NC41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyMTQuNSIgeDI9IjQyMy41IiB5MT0iOTQuNTYyNSIgeTI9Ijk0LjU2MjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDgiIHg9IjIyMS41IiB5PSI4OS40OTY2Ij5BbGxvY2F0ZSBSZXF1ZXN0PC90ZXh0PjxwYXRoIGQ9Ik03MSw3NS40Mjk3IEw3MSwxMDAuNDI5NyBMMjA5LDEwMC40Mjk3IEwyMDksODUuNDI5NyBMMTk5LDc1LjQyOTcgTDcxLDc1LjQyOTcgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTk5LDc1LjQyOTcgTDE5OSw4NS40Mjk3IEwyMDksODUuNDI5NyBMMTk5LDc1LjQyOTcgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTciIHg9Ijc3IiB5PSI5Mi40OTY2Ij7lsJ3or5Xkvb/nlKjljL/lkI3nmoTor7fmsYI8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMjUuNSwxMjIuNjk1MywyMTUuNSwxMjYuNjk1MywyMjUuNSwxMzAuNjk1MywyMjEuNSwxMjYuNjk1MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjE5LjUiIHgyPSI0MzMuNSIgeTE9IjEyNi42OTUzIiB5Mj0iMTI2LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTMiIHg9IjIzMS41IiB5PSIxMjEuNjI5NCI+QWxsb2NhdGUgRXJyb3IgUmVzcG9uc2U8L3RleHQ+PHBhdGggZD0iTTksMTQ4LjY5NTMgTDE3NywxNDguNjk1MyBMMTc3LDE1NS44MjgxIEwxNjcsMTY1LjgyODEgTDksMTY1LjgyODEgTDksMTQ4LjY5NTMgIiBmaWxsPSIjRUVFRUVFIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjgxLjM5ODQiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9Ijg4MiIgeD0iOSIgeT0iMTQ4LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIzIiB4PSIyNCIgeT0iMTYxLjc2MjIiPkFsbG9jYXRlIOmVv+aViOmJtOadgzwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQxNy41LDE4OC45NjA5LDQyNy41LDE5Mi45NjA5LDQxNy41LDE5Ni45NjA5LDQyMS41LDE5Mi45NjA5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyMTQuNSIgeDI9IjQyMy41IiB5MT0iMTkyLjk2MDkiIHkyPSIxOTIuOTYwOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4MiIgeD0iMjIxLjUiIHk9IjE4Ny44OTUiPkFsbG9jYXRlIFJlcXVlc3Qgd2l0aCBub25jZTwvdGV4dD48cGF0aCBkPSJNMTksMTcwLjgyODEgTDE5LDE5NS44MjgxIEwyMDksMTk1LjgyODEgTDIwOSwxODAuODI4MSBMMTk5LDE3MC44MjgxIEwxOSwxNzAuODI4MSAiIGZpbGw9IiNGRkZGRkYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xOTksMTcwLjgyODEgTDE5OSwxODAuODI4MSBMMjA5LDE4MC44MjgxIEwxOTksMTcwLjgyODEgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjkiIHg9IjI1IiB5PSIxODcuODk1Ij7ljL/lkI3or7fmsYLlpLHotKXvvIzkvb/nlKjpibTmnYPmlrnlvI88L3RleHQ+PHBhdGggZD0iTTQ0NCwxNzAuODI4MSBMNDQ0LDE5NS44MjgxIEw4ODYsMTk1LjgyODEgTDg4NiwxODAuODI4MSBMODc2LDE3MC44MjgxIEw0NDQsMTcwLjgyODEgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNODc2LDE3MC44MjgxIEw4NzYsMTgwLjgyODEgTDg4NiwxODAuODI4MSBMODc2LDE3MC44MjgxICIgZmlsbD0iI0ZGRkZGRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIxIiB4PSI0NTAiIHk9IjE4Ny44OTUiPuWcqFhPUi1SRUxBWUVELUFERFJFU1PlrZfmrrXov5Tlm55zZXJ2ZXLnmoRwdWJsaWMgSVDvvIzlnKjphY3nva7kuK3ojrflj5Y8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMjUuNSwyMTguMDkzOCwyMTUuNSwyMjIuMDkzOCwyMjUuNSwyMjYuMDkzOCwyMjEuNSwyMjIuMDkzOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjE5LjUiIHgyPSI0MzMuNSIgeTE9IjIyMi4wOTM4IiB5Mj0iMjIyLjA5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzQiIHg9IjIzMS41IiB5PSIyMTcuMDI3OCI+QWxsb2NhdGUgU3VjY2VzcyBSZXNwb25zZTwvdGV4dD48cGF0aCBkPSJNMTc3LDI0NC4wOTM4IEwyNjQsMjQ0LjA5MzggTDI2NCwyNTEuMjI2NiBMMjU0LDI2MS4yMjY2IEwxNzcsMjYxLjIyNjYgTDE3NywyNDQuMDkzOCAiIGZpbGw9IiNFRUVFRUUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNzUuMzk4NCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMjk3IiB4PSIxNzciIHk9IjI0NC4wOTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQyIiB4PSIxOTIiIHk9IjI1Ny4xNjA2Ij7kuI3lj6/ovr48L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MjIuNSwyNzguMzU5NCw0MzIuNSwyODIuMzU5NCw0MjIuNSwyODYuMzU5NCw0MjYuNSwyODIuMzU5NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjE0LjUiIHgyPSI0MjguNSIgeTE9IjI4Mi4zNTk0IiB5Mj0iMjgyLjM1OTQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTEiIHg9IjIyMS41IiB5PSIyNzcuMjkzNSI+U1RVTjogQWxsb2NhdGUgUmVxdWVzdDwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIyNS41LDMwNy40OTIyLDIxNS41LDMxMS40OTIyLDIyNS41LDMxNS40OTIyLDIyMS41LDMxMS40OTIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyMTkuNSIgeDI9IjQzMy41IiB5MT0iMzExLjQ5MjIiIHkyPSIzMTEuNDkyMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5NiIgeD0iMjMxLjUiIHk9IjMwNi40MjYzIj5JQ01QOiBEZXN0aW5hdGlvbiBVbnJlYWNoYWJsZTwvdGV4dD48IS0tTUQ1PVtiMDUzNzkzMDA5M2RhMjBiMmU5MTZjMzdkYjFhNWEyMl0KQHN0YXJ0dW1sDQpza2lucGFyYW0gTm90ZUJhY2tncm91bmRDb2xvciB3aGl0ZQ0KDQpncm91cCBBbGxvY2F0ZSDljL/lkI0NCmNsaWVudCAtPiBzZXJ2ZXIgOiBBbGxvY2F0ZSBSZXF1ZXN0DQphY3RpdmF0ZSBzZXJ2ZXINCm5vdGUgbGVmdDog5bCd6K+V5L2/55So5Yy/5ZCN55qE6K+35rGCDQpzZXJ2ZXIgLT4gY2xpZW50IDogQWxsb2NhdGUgRXJyb3IgUmVzcG9uc2UNCmRlYWN0aXZhdGUgc2VydmVyDQplbmQNCg0KDQpncm91cCBBbGxvY2F0ZSDplb/mlYjpibTmnYMNCmNsaWVudCAtPiBzZXJ2ZXIgOiBBbGxvY2F0ZSBSZXF1ZXN0IHdpdGggbm9uY2UNCmFjdGl2YXRlIHNlcnZlcg0Kbm90ZSBsZWZ0OiDljL/lkI3or7fmsYLlpLHotKXvvIzkvb/nlKjpibTmnYPmlrnlvI8NCm5vdGUgcmlnaHQ6IOWcqFhPUi1SRUxBWUVELUFERFJFU1PlrZfmrrXov5Tlm55zZXJ2ZXLnmoRwdWJsaWMgSVDvvIzlnKjphY3nva7kuK3ojrflj5YNCnNlcnZlciAtPiBjbGllbnQgOiBBbGxvY2F0ZSBTdWNjZXNzIFJlc3BvbnNlDQpkZWFjdGl2YXRlIHNlcnZlcg0KZW5kDQoNCmdyb3VwIOS4jeWPr+i+vg0KY2xpZW50IC0+IHNlcnZlciA6IFNUVU46IEFsbG9jYXRlIFJlcXVlc3QNCnNlcnZlciAtPiBjbGllbnQgOiBJQ01QOiBEZXN0aW5hdGlvbiBVbnJlYWNoYWJsZQ0KZW5kDQpAZW5kdW1sDQoKUGxhbnRVTUwgdmVyc2lvbiAxLjIwMjIuMTBiZXRhMihVbmtub3duIGNvbXBpbGUgdGltZSkKKEdQTCBzb3VyY2UgZGlzdHJpYnV0aW9uKQpKYXZhIFJ1bnRpbWU6IEphdmEoVE0pIFNFIFJ1bnRpbWUgRW52aXJvbm1lbnQKSlZNOiBKYXZhIEhvdFNwb3QoVE0pIDY0LUJpdCBTZXJ2ZXIgVk0KRGVmYXVsdCBFbmNvZGluZzogVVRGLTgKTGFuZ3VhZ2U6IGVuCkNvdW50cnk6IFVTCi0tPjwvZz48L3N2Zz4='>

<h4 id="数据交换之转发机制"><a href="#数据交换之转发机制" class="headerlink" title="数据交换之转发机制"></a>数据交换之转发机制</h4><p>使用Indication标识转发数据，Send和Data不支持长效验证，因此需要先获得permission再开始indication发送数据。一旦permission建立，信任这个address发来的数据，时效5min，且无法通过收发数据刷新时效。</p>
<p>webrtc使用indication做连通性测试，即Ping。</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIzNDZweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjExMzBweDtoZWlnaHQ6MzQ2cHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMTEzMCAzNDYiIHdpZHRoPSIxMTMwcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjMyLjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI2NTcuNSIgeT0iOTQuNTYyNSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMjkuMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjY1Ny41IiB5PSIxOTIuOTYwOSIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iODEuMzk4NCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNzY0LjUiIHg9IjM2MCIgeT0iNTMuMjk2OSIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMTQ1LjY2NDEiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9Ijg2MC41IiB4PSI5IiB5PSIxNDguNjk1MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSIzOTciIHgyPSIzOTciIHkxPSIzNi4yOTY5IiB5Mj0iMzExLjM1OTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iNjYyIiB4Mj0iNjYyIiB5MT0iMzYuMjk2OSIgeTI9IjMxMS4zNTk0Ii8+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1NSIgeD0iMzcwIiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEiIHg9IjM3NyIgeT0iMjQuOTk1MSI+Y2xpZW50PC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTUiIHg9IjM3MCIgeT0iMzEwLjM1OTQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MSIgeD0iMzc3IiB5PSIzMzAuMzU0NSI+Y2xpZW50PC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTkiIHg9IjYzMyIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ1IiB4PSI2NDAiIHk9IjI0Ljk5NTEiPnNlcnZlcjwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjU5IiB4PSI2MzMiIHk9IjMxMC4zNTk0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDUiIHg9IjY0MCIgeT0iMzMwLjM1NDUiPnNlcnZlcjwvdGV4dD48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjMyLjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI2NTcuNSIgeT0iOTQuNTYyNSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMjkuMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjY1Ny41IiB5PSIxOTIuOTYwOSIvPjxwYXRoIGQ9Ik0zNjAsNTMuMjk2OSBMNDM3LDUzLjI5NjkgTDQzNyw2MC40Mjk3IEw0MjcsNzAuNDI5NyBMMzYwLDcwLjQyOTcgTDM2MCw1My4yOTY5ICIgZmlsbD0iI0VFRUVFRSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI4MS4zOTg0IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI3NjQuNSIgeD0iMzYwIiB5PSI1My4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMyIiB4PSIzNzUiIHk9IjY2LjM2MzgiPlBpbmc8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NDUuNSw5MC41NjI1LDY1NS41LDk0LjU2MjUsNjQ1LjUsOTguNTYyNSw2NDkuNSw5NC41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzOTcuNSIgeDI9IjY1MS41IiB5MT0iOTQuNTYyNSIgeTI9Ijk0LjU2MjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDMiIHg9IjQwNC41IiB5PSI4OS40OTY2Ij5CaW5kaW5nIFJlcXVlc3Q8L3RleHQ+PHBhdGggZD0iTTY3Miw3NS40Mjk3IEw2NzIsMTAwLjQyOTcgTDExMTksMTAwLjQyOTcgTDExMTksODUuNDI5NyBMMTEwOSw3NS40Mjk3IEw2NzIsNzUuNDI5NyAiIGZpbGw9IiNGRkZGRkYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xMTA5LDc1LjQyOTcgTDExMDksODUuNDI5NyBMMTExOSw4NS40Mjk3IEwxMTA5LDc1LjQyOTcgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MjYiIHg9IjY3OCIgeT0iOTIuNDk2NiI+5ZyoWE9SLU1BUFBFRC1BRERSRVNT5a2X5q616L+U5ZueY2xpZW5055qEZXh0ZXJuYWwgSVDvvIxzZXJ2ZXLnnIvliLDnmoQ8L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MDguNSwxMjIuNjk1MywzOTguNSwxMjYuNjk1Myw0MDguNSwxMzAuNjk1Myw0MDQuNSwxMjYuNjk1MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDAyLjUiIHgyPSI2NjEuNSIgeTE9IjEyNi42OTUzIiB5Mj0iMTI2LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjkiIHg9IjQxNC41IiB5PSIxMjEuNjI5NCI+QmluZGluZyBTdWNjZXNzIFJlc3BvbnNlPC90ZXh0PjxwYXRoIGQ9Ik05LDE0OC42OTUzIEwxMTAsMTQ4LjY5NTMgTDExMCwxNTUuODI4MSBMMTAwLDE2NS44MjgxIEw5LDE2NS44MjgxIEw5LDE0OC42OTUzICIgZmlsbD0iI0VFRUVFRSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIxNDUuNjY0MSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iODYwLjUiIHg9IjkiIHk9IjE0OC42OTUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2IiB4PSIyNCIgeT0iMTYxLjc2MjIiPui9rOWPkeaVsOaNrjwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY0NS41LDE4OC45NjA5LDY1NS41LDE5Mi45NjA5LDY0NS41LDE5Ni45NjA5LDY0OS41LDE5Mi45NjA5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzOTcuNSIgeDI9IjY1MS41IiB5MT0iMTkyLjk2MDkiIHkyPSIxOTIuOTYwOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3MCIgeD0iNDA0LjUiIHk9IjE4Ny44OTUiPkNyZWF0ZVBlcm1pc3Npb24gUmVxdWVzdDwvdGV4dD48cGF0aCBkPSJNMTksMTcwLjgyODEgTDE5LDE5NS44MjgxIEwzOTIsMTk1LjgyODEgTDM5MiwxODAuODI4MSBMMzgyLDE3MC44MjgxIEwxOSwxNzAuODI4MSAiIGZpbGw9IiNGRkZGRkYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0zODIsMTcwLjgyODEgTDM4MiwxODAuODI4MSBMMzkyLDE4MC44MjgxIEwzODIsMTcwLjgyODEgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNTIiIHg9IjI1IiB5PSIxODcuODk1Ij7luKbkuIrpibTmnYPkv6Hmga/vvIxYT1ItUEVFUi1BRERSRVNT5aGrY2xpZW5055qEZXh0ZXJuYWwgSVA8L3RleHQ+PHBhdGggZD0iTTY3MiwxNzAuODI4MSBMNjcyLDE5NS44MjgxIEw4NDEsMTk1LjgyODEgTDg0MSwxODAuODI4MSBMODMxLDE3MC44MjgxIEw2NzIsMTcwLjgyODEgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNODMxLDE3MC44MjgxIEw4MzEsMTgwLjgyODEgTDg0MSwxODAuODI4MSBMODMxLDE3MC44MjgxICIgZmlsbD0iI0ZGRkZGRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ4IiB4PSI2NzgiIHk9IjE4Ny44OTUiPuiusOW9leWcqHBlcm1pc3Npb27liJfooajkuK08L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MDguNSwyMTguMDkzOCwzOTguNSwyMjIuMDkzOCw0MDguNSwyMjYuMDkzOCw0MDQuNSwyMjIuMDkzOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDAyLjUiIHgyPSI2NjEuNSIgeTE9IjIyMi4wOTM4IiB5Mj0iMjIyLjA5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMzYiIHg9IjQxNC41IiB5PSIyMTcuMDI3OCI+Q3JlYXRlUGVybWlzc2lvbiBTdWNjZXNzIFJlc3BvbnNlPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjUwLjUsMjUwLjIyNjYsNjYwLjUsMjU0LjIyNjYsNjUwLjUsMjU4LjIyNjYsNjU0LjUsMjU0LjIyNjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM5Ny41IiB4Mj0iNjU2LjUiIHkxPSIyNTQuMjI2NiIgeTI9IjI1NC4yMjY2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTciIHg9IjQwNC41IiB5PSIyNDkuMTYwNiI+U2VuZCBJbmRpY2F0aW9uPC90ZXh0PjxwYXRoIGQ9Ik02NjcsMjM1LjA5MzggTDY2NywyNjAuMDkzOCBMODU0LDI2MC4wOTM4IEw4NTQsMjQ1LjA5MzggTDg0NCwyMzUuMDkzOCBMNjY3LDIzNS4wOTM4ICIgZmlsbD0iI0ZGRkZGRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTg0NCwyMzUuMDkzOCBMODQ0LDI0NS4wOTM4IEw4NTQsMjQ1LjA5MzggTDg0NCwyMzUuMDkzOCAiIGZpbGw9IiNGRkZGRkYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2NiIgeD0iNjczIiB5PSIyNTIuMTYwNiI+5LuOREFUQeWtl+auteino+aekOW5tui9rOWPkeaVsOaNrjwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQwOC41LDI4Mi4zNTk0LDM5OC41LDI4Ni4zNTk0LDQwOC41LDI5MC4zNTk0LDQwNC41LDI4Ni4zNTk0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0MDIuNSIgeDI9IjY2MS41IiB5MT0iMjg2LjM1OTQiIHkyPSIyODYuMzU5NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2IiB4PSI0MTQuNSIgeT0iMjgxLjI5MzUiPkRhdGEgSW5kaWNhdGlvbjwvdGV4dD48IS0tTUQ1PVs2ZDI1Yjc1YzM1NmMzZTFjNTM0ZmNkODBkNTZjMmY2NF0KQHN0YXJ0dW1sDQpza2lucGFyYW0gTm90ZUJhY2tncm91bmRDb2xvciB3aGl0ZQ0KDQpncm91cCBQaW5nDQpjbGllbnQgLT4gc2VydmVyIDogQmluZGluZyBSZXF1ZXN0DQphY3RpdmF0ZSBzZXJ2ZXINCm5vdGUgcmlnaHQ6IOWcqFhPUi1NQVBQRUQtQUREUkVTU+Wtl+autei/lOWbnmNsaWVudOeahGV4dGVybmFsIElQ77yMc2VydmVy55yL5Yiw55qEDQpzZXJ2ZXIgLT4gY2xpZW50IDogQmluZGluZyBTdWNjZXNzIFJlc3BvbnNlDQpkZWFjdGl2YXRlIHNlcnZlcg0KZW5kDQoNCmdyb3VwIOi9rOWPkeaVsOaNrg0KY2xpZW50IC0+IHNlcnZlciA6IENyZWF0ZVBlcm1pc3Npb24gUmVxdWVzdA0KYWN0aXZhdGUgc2VydmVyDQpub3RlIGxlZnQ6IOW4puS4iumJtOadg+S/oeaBr++8jFhPUi1QRUVSLUFERFJFU1PloatjbGllbnTnmoRleHRlcm5hbCBJUA0Kbm90ZSByaWdodDog6K6w5b2V5ZyocGVybWlzc2lvbuWIl+ihqOS4rQ0Kc2VydmVyIC0+IGNsaWVudCA6IENyZWF0ZVBlcm1pc3Npb24gU3VjY2VzcyBSZXNwb25zZQ0KZGVhY3RpdmF0ZSBzZXJ2ZXINCg0KY2xpZW50IC0+IHNlcnZlciA6IFNlbmQgSW5kaWNhdGlvbg0Kbm90ZSByaWdodDog5LuOREFUQeWtl+auteino+aekOW5tui9rOWPkeaVsOaNrg0Kc2VydmVyIC0+IGNsaWVudCA6IERhdGEgSW5kaWNhdGlvbg0KDQplbmQNCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMi4xMGJldGEyKFVua25vd24gY29tcGlsZSB0aW1lKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogSmF2YShUTSkgU0UgUnVudGltZSBFbnZpcm9ubWVudApKVk06IEphdmEgSG90U3BvdChUTSkgNjQtQml0IFNlcnZlciBWTQpEZWZhdWx0IEVuY29kaW5nOiBVVEYtOApMYW5ndWFnZTogZW4KQ291bnRyeTogVVMKLS0+PC9nPjwvc3ZnPg=='>

<h4 id="数据交换之信道机制"><a href="#数据交换之信道机制" class="headerlink" title="数据交换之信道机制"></a>数据交换之信道机制</h4><p><code>send/data indication</code>添加在stun的应用层的头部，需要36字节的开销，在有些带宽资源敏感的场景，比如VoIP，就显著增加了带宽。turn提供了ChannelData消息格式做数据交换。</p>
<p>ChannelData不使用stun应用头部，而是使用4字节的信道号做标识。client在request消息带上未绑定的信道编号和地址信息给server，server若同意绑定，client就可以使用这个信道编号发送ChannelData消息给目的peer，server也可以通过这个信道转发数据给client。</p>
<p>channel时效10min，ChannelData消息或重新绑定channel到peer都可以刷新channel的时效，但是它只能过期，不能像indication通过设置lifetime=0立即失效。</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIzNDZweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjExMzBweDtoZWlnaHQ6MzQ2cHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMTEzMCAzNDYiIHdpZHRoPSIxMTMwcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI5LjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI2NTcuNSIgeT0iOTcuNTYyNSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMjkuMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjY1Ny41IiB5PSIxOTIuOTYwOSIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iODEuMzk4NCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTA3MiIgeD0iNTIiIHk9IjUzLjI5NjkiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjE0NS42NjQxIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI4NjAuNSIgeD0iOSIgeT0iMTQ4LjY5NTMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iMzk3IiB4Mj0iMzk3IiB5MT0iMzYuMjk2OSIgeTI9IjMxMS4zNTk0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjY2MiIgeDI9IjY2MiIgeTE9IjM2LjI5NjkiIHkyPSIzMTEuMzU5NCIvPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTUiIHg9IjM3MCIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxIiB4PSIzNzciIHk9IjI0Ljk5NTEiPmNsaWVudDwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjU1IiB4PSIzNzAiIHk9IjMxMC4zNTk0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEiIHg9IjM3NyIgeT0iMzMwLjM1NDUiPmNsaWVudDwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjU5IiB4PSI2MzMiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NSIgeD0iNjQwIiB5PSIyNC45OTUxIj5zZXJ2ZXI8L3RleHQ+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1OSIgeD0iNjMzIiB5PSIzMTAuMzU5NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ1IiB4PSI2NDAiIHk9IjMzMC4zNTQ1Ij5zZXJ2ZXI8L3RleHQ+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIyOS4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHdpZHRoPSIxMCIgeD0iNjU3LjUiIHk9Ijk3LjU2MjUiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI5LjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSI2NTcuNSIgeT0iMTkyLjk2MDkiLz48cGF0aCBkPSJNNTIsNTMuMjk2OSBMMTgyLDUzLjI5NjkgTDE4Miw2MC40Mjk3IEwxNzIsNzAuNDI5NyBMNTIsNzAuNDI5NyBMNTIsNTMuMjk2OSAiIGZpbGw9IiNFRUVFRUUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iODEuMzk4NCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTA3MiIgeD0iNTIiIHk9IjUzLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODUiIHg9IjY3IiB5PSI2Ni4zNjM4Ij7liIbphY1jaGFubmVsPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjQ1LjUsOTMuNTYyNSw2NTUuNSw5Ny41NjI1LDY0NS41LDEwMS41NjI1LDY0OS41LDk3LjU2MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM5Ny41IiB4Mj0iNjUxLjUiIHkxPSI5Ny41NjI1IiB5Mj0iOTcuNTYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0MSIgeD0iNDA0LjUiIHk9IjkyLjQ5NjYiPkNoYW5uZWwtQmluZCBSZXF1ZXN0PC90ZXh0PjxwYXRoIGQ9Ik02Miw3NS40Mjk3IEw2MiwxMDAuNDI5NyBMMzkyLDEwMC40Mjk3IEwzOTIsODUuNDI5NyBMMzgyLDc1LjQyOTcgTDYyLDc1LjQyOTcgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMzgyLDc1LjQyOTcgTDM4Miw4NS40Mjk3IEwzOTIsODUuNDI5NyBMMzgyLDc1LjQyOTcgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMDkiIHg9IjY4IiB5PSI5Mi40OTY2Ij7luKbkuIrliIbphY3lpb3nmoRjaGFubmVsIG51bWJlcuWSjHRyYW5zcG9ydCBhZGRyZXNzPC90ZXh0PjxwYXRoIGQ9Ik02NzIsNzUuNDI5NyBMNjcyLDEwMC40Mjk3IEwxMTE5LDEwMC40Mjk3IEwxMTE5LDg1LjQyOTcgTDExMDksNzUuNDI5NyBMNjcyLDc1LjQyOTcgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTEwOSw3NS40Mjk3IEwxMTA5LDg1LjQyOTcgTDExMTksODUuNDI5NyBMMTEwOSw3NS40Mjk3ICIgZmlsbD0iI0ZGRkZGRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDI2IiB4PSI2NzgiIHk9IjkyLjQ5NjYiPuWcqFhPUi1NQVBQRUQtQUREUkVTU+Wtl+autei/lOWbnmNsaWVudOeahGV4dGVybmFsIElQ77yMc2VydmVy55yL5Yiw55qEPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDA4LjUsMTIyLjY5NTMsMzk4LjUsMTI2LjY5NTMsNDA4LjUsMTMwLjY5NTMsNDA0LjUsMTI2LjY5NTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjQwMi41IiB4Mj0iNjYxLjUiIHkxPSIxMjYuNjk1MyIgeTI9IjEyNi42OTUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjA3IiB4PSI0MTQuNSIgeT0iMTIxLjYyOTQiPkNoYW5uZWwtQmluZCBTdWNjZXNzIFJlc3BvbnNlPC90ZXh0PjxwYXRoIGQ9Ik05LDE0OC42OTUzIEwxMTAsMTQ4LjY5NTMgTDExMCwxNTUuODI4MSBMMTAwLDE2NS44MjgxIEw5LDE2NS44MjgxIEw5LDE0OC42OTUzICIgZmlsbD0iI0VFRUVFRSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIxNDUuNjY0MSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iODYwLjUiIHg9IjkiIHk9IjE0OC42OTUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2IiB4PSIyNCIgeT0iMTYxLjc2MjIiPui9rOWPkeaVsOaNrjwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY0NS41LDE4OC45NjA5LDY1NS41LDE5Mi45NjA5LDY0NS41LDE5Ni45NjA5LDY0OS41LDE5Mi45NjA5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzOTcuNSIgeDI9IjY1MS41IiB5MT0iMTkyLjk2MDkiIHkyPSIxOTIuOTYwOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3MCIgeD0iNDA0LjUiIHk9IjE4Ny44OTUiPkNyZWF0ZVBlcm1pc3Npb24gUmVxdWVzdDwvdGV4dD48cGF0aCBkPSJNMTksMTcwLjgyODEgTDE5LDE5NS44MjgxIEwzOTIsMTk1LjgyODEgTDM5MiwxODAuODI4MSBMMzgyLDE3MC44MjgxIEwxOSwxNzAuODI4MSAiIGZpbGw9IiNGRkZGRkYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0zODIsMTcwLjgyODEgTDM4MiwxODAuODI4MSBMMzkyLDE4MC44MjgxIEwzODIsMTcwLjgyODEgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNTIiIHg9IjI1IiB5PSIxODcuODk1Ij7luKbkuIrpibTmnYPkv6Hmga/vvIxYT1ItUEVFUi1BRERSRVNT5aGrY2xpZW5055qEZXh0ZXJuYWwgSVA8L3RleHQ+PHBhdGggZD0iTTY3MiwxNzAuODI4MSBMNjcyLDE5NS44MjgxIEw4NDEsMTk1LjgyODEgTDg0MSwxODAuODI4MSBMODMxLDE3MC44MjgxIEw2NzIsMTcwLjgyODEgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNODMxLDE3MC44MjgxIEw4MzEsMTgwLjgyODEgTDg0MSwxODAuODI4MSBMODMxLDE3MC44MjgxICIgZmlsbD0iI0ZGRkZGRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ4IiB4PSI2NzgiIHk9IjE4Ny44OTUiPuiusOW9leWcqHBlcm1pc3Npb27liJfooajkuK08L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MDguNSwyMTguMDkzOCwzOTguNSwyMjIuMDkzOCw0MDguNSwyMjYuMDkzOCw0MDQuNSwyMjIuMDkzOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDAyLjUiIHgyPSI2NjEuNSIgeTE9IjIyMi4wOTM4IiB5Mj0iMjIyLjA5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMzYiIHg9IjQxNC41IiB5PSIyMTcuMDI3OCI+Q3JlYXRlUGVybWlzc2lvbiBTdWNjZXNzIFJlc3BvbnNlPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjUwLjUsMjUwLjIyNjYsNjYwLjUsMjU0LjIyNjYsNjUwLjUsMjU4LjIyNjYsNjU0LjUsMjU0LjIyNjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM5Ny41IiB4Mj0iNjU2LjUiIHkxPSIyNTQuMjI2NiIgeTI9IjI1NC4yMjY2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTciIHg9IjQwNC41IiB5PSIyNDkuMTYwNiI+U2VuZCBJbmRpY2F0aW9uPC90ZXh0PjxwYXRoIGQ9Ik02NjcsMjM1LjA5MzggTDY2NywyNjAuMDkzOCBMODU0LDI2MC4wOTM4IEw4NTQsMjQ1LjA5MzggTDg0NCwyMzUuMDkzOCBMNjY3LDIzNS4wOTM4ICIgZmlsbD0iI0ZGRkZGRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTg0NCwyMzUuMDkzOCBMODQ0LDI0NS4wOTM4IEw4NTQsMjQ1LjA5MzggTDg0NCwyMzUuMDkzOCAiIGZpbGw9IiNGRkZGRkYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2NiIgeD0iNjczIiB5PSIyNTIuMTYwNiI+5LuOREFUQeWtl+auteino+aekOW5tui9rOWPkeaVsOaNrjwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQwOC41LDI4Mi4zNTk0LDM5OC41LDI4Ni4zNTk0LDQwOC41LDI5MC4zNTk0LDQwNC41LDI4Ni4zNTk0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0MDIuNSIgeDI9IjY2MS41IiB5MT0iMjg2LjM1OTQiIHkyPSIyODYuMzU5NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2IiB4PSI0MTQuNSIgeT0iMjgxLjI5MzUiPkRhdGEgSW5kaWNhdGlvbjwvdGV4dD48IS0tTUQ1PVtmNWYwMDk3ZDUwMjhhMDhlMjFmNTU5NjAxMTAyOTM5MF0KQHN0YXJ0dW1sDQpza2lucGFyYW0gTm90ZUJhY2tncm91bmRDb2xvciB3aGl0ZQ0KDQpncm91cCDliIbphY1jaGFubmVsDQpjbGllbnQgLT4gc2VydmVyIDogQ2hhbm5lbC1CaW5kIFJlcXVlc3QNCmFjdGl2YXRlIHNlcnZlcg0Kbm90ZSBsZWZ0OiDluKbkuIrliIbphY3lpb3nmoRjaGFubmVsIG51bWJlcuWSjHRyYW5zcG9ydCBhZGRyZXNzDQpub3RlIHJpZ2h0OiDlnKhYT1ItTUFQUEVELUFERFJFU1PlrZfmrrXov5Tlm55jbGllbnTnmoRleHRlcm5hbCBJUO+8jHNlcnZlcueci+WIsOeahA0Kc2VydmVyIC0+IGNsaWVudCA6IENoYW5uZWwtQmluZCBTdWNjZXNzIFJlc3BvbnNlDQpkZWFjdGl2YXRlIHNlcnZlcg0KZW5kDQoNCmdyb3VwIOi9rOWPkeaVsOaNrg0KY2xpZW50IC0+IHNlcnZlciA6IENyZWF0ZVBlcm1pc3Npb24gUmVxdWVzdA0KYWN0aXZhdGUgc2VydmVyDQpub3RlIGxlZnQ6IOW4puS4iumJtOadg+S/oeaBr++8jFhPUi1QRUVSLUFERFJFU1PloatjbGllbnTnmoRleHRlcm5hbCBJUA0Kbm90ZSByaWdodDog6K6w5b2V5ZyocGVybWlzc2lvbuWIl+ihqOS4rQ0Kc2VydmVyIC0+IGNsaWVudCA6IENyZWF0ZVBlcm1pc3Npb24gU3VjY2VzcyBSZXNwb25zZQ0KZGVhY3RpdmF0ZSBzZXJ2ZXINCg0KY2xpZW50IC0+IHNlcnZlciA6IFNlbmQgSW5kaWNhdGlvbg0Kbm90ZSByaWdodDog5LuOREFUQeWtl+auteino+aekOW5tui9rOWPkeaVsOaNrg0Kc2VydmVyIC0+IGNsaWVudCA6IERhdGEgSW5kaWNhdGlvbg0KDQplbmQNCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMi4xMGJldGEyKFVua25vd24gY29tcGlsZSB0aW1lKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogSmF2YShUTSkgU0UgUnVudGltZSBFbnZpcm9ubWVudApKVk06IEphdmEgSG90U3BvdChUTSkgNjQtQml0IFNlcnZlciBWTQpEZWZhdWx0IEVuY29kaW5nOiBVVEYtOApMYW5ndWFnZTogZW4KQ291bnRyeTogVVMKLS0+PC9nPjwvc3ZnPg=='>



<h4 id="保活机制"><a href="#保活机制" class="headerlink" title="保活机制"></a>保活机制</h4><p>中继分配好之后，中继信息存在server的allocation map里，客户端需要发送refresh消息进行保活，refresh消息也必须带上鉴权信息。<br>server每次收到新的refresh请求，更新lifetime，给allocation续期。</p>
<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIyODJweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjY0NHB4O2hlaWdodDoyODJweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA2NDQgMjgyIiB3aWR0aD0iNjQ0cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI5LjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSIzNzguNSIgeT0iOTcuNTYyNSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMjkuMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjM3OC41IiB5PSIxOTIuOTYwOSIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iODEuMzk4NCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNTYwIiB4PSI5IiB5PSI1My4yOTY5Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI4MS4zOTg0IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI1NTkiIHg9Ijc5IiB5PSIxNDguNjk1MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSIxODEiIHgyPSIxODEiIHkxPSIzNi4yOTY5IiB5Mj0iMjQ3LjA5MzgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUuMCw1LjA7IiB4MT0iMzgzIiB4Mj0iMzgzIiB5MT0iMzYuMjk2OSIgeTI9IjI0Ny4wOTM4Ii8+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1NSIgeD0iMTU0IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEiIHg9IjE2MSIgeT0iMjQuOTk1MSI+Y2xpZW50PC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTUiIHg9IjE1NCIgeT0iMjQ2LjA5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MSIgeD0iMTYxIiB5PSIyNjYuMDg4OSI+Y2xpZW50PC90ZXh0PjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTkiIHg9IjM1NCIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ1IiB4PSIzNjEiIHk9IjI0Ljk5NTEiPnNlcnZlcjwvdGV4dD48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjU5IiB4PSIzNTQiIHk9IjI0Ni4wOTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDUiIHg9IjM2MSIgeT0iMjY2LjA4ODkiPnNlcnZlcjwvdGV4dD48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI5LjEzMjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgd2lkdGg9IjEwIiB4PSIzNzguNSIgeT0iOTcuNTYyNSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMjkuMTMyOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iMTAiIHg9IjM3OC41IiB5PSIxOTIuOTYwOSIvPjxwYXRoIGQ9Ik05LDUzLjI5NjkgTDE1Nyw1My4yOTY5IEwxNTcsNjAuNDI5NyBMMTQ3LDcwLjQyOTcgTDksNzAuNDI5NyBMOSw1My4yOTY5ICIgZmlsbD0iI0VFRUVFRSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI4MS4zOTg0IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI1NjAiIHg9IjkiIHk9IjUzLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAzIiB4PSIyNCIgeT0iNjYuMzYzOCI+57ut5pyfYWxsb2NhdGlvbjwvdGV4dD48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM2Ni41LDkzLjU2MjUsMzc2LjUsOTcuNTYyNSwzNjYuNSwxMDEuNTYyNSwzNzAuNSw5Ny41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxODEuNSIgeDI9IjM3Mi41IiB5MT0iOTcuNTYyNSIgeTI9Ijk3LjU2MjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDciIHg9IjE4OC41IiB5PSI5Mi40OTY2Ij5SZWZyZXNoIFJlcXVlc3Q8L3RleHQ+PHBhdGggZD0iTTE5LDc1LjQyOTcgTDE5LDEwMC40Mjk3IEwxNzYsMTAwLjQyOTcgTDE3Niw4NS40Mjk3IEwxNjYsNzUuNDI5NyBMMTksNzUuNDI5NyAiIGZpbGw9IiNGRkZGRkYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xNjYsNzUuNDI5NyBMMTY2LDg1LjQyOTcgTDE3Niw4NS40Mjk3IEwxNjYsNzUuNDI5NyAiIGZpbGw9IiNGRkZGRkYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNiIgeD0iMjUiIHk9IjkyLjQ5NjYiPmxpZmV0aW1lJmd0OzDvvIzpu5jorqQ2MDBzPC90ZXh0PjxwYXRoIGQ9Ik0zOTMsNzUuNDI5NyBMMzkzLDEwMC40Mjk3IEw1NjQsMTAwLjQyOTcgTDU2NCw4NS40Mjk3IEw1NTQsNzUuNDI5NyBMMzkzLDc1LjQyOTcgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNTU0LDc1LjQyOTcgTDU1NCw4NS40Mjk3IEw1NjQsODUuNDI5NyBMNTU0LDc1LjQyOTcgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTAiIHg9IjM5OSIgeT0iOTIuNDk2NiI+c2V0IGxpZmV0aW1l77yM5Yi35paw5a6a5pe25ZmoPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTkyLjUsMTIyLjY5NTMsMTgyLjUsMTI2LjY5NTMsMTkyLjUsMTMwLjY5NTMsMTg4LjUsMTI2LjY5NTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE4Ni41IiB4Mj0iMzgyLjUiIHkxPSIxMjYuNjk1MyIgeTI9IjEyNi42OTUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTczIiB4PSIxOTguNSIgeT0iMTIxLjYyOTQiPlJlZnJlc2ggU3VjY2VzcyBSZXNwb25zZTwvdGV4dD48cGF0aCBkPSJNNzksMTQ4LjY5NTMgTDI2OSwxNDguNjk1MyBMMjY5LDE1NS44MjgxIEwyNTksMTY1LjgyODEgTDc5LDE2NS44MjgxIEw3OSwxNDguNjk1MyAiIGZpbGw9IiNFRUVFRUUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iODEuMzk4NCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNTU5IiB4PSI3OSIgeT0iMTQ4LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ1IiB4PSI5NCIgeT0iMTYxLjc2MjIiPkRpc2Nvbm5lY3Qg5pat5byA6L+e5o6lPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzY2LjUsMTg4Ljk2MDksMzc2LjUsMTkyLjk2MDksMzY2LjUsMTk2Ljk2MDksMzcwLjUsMTkyLjk2MDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE4MS41IiB4Mj0iMzcyLjUiIHkxPSIxOTIuOTYwOSIgeTI9IjE5Mi45NjA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA3IiB4PSIxODguNSIgeT0iMTg3Ljg5NSI+UmVmcmVzaCBSZXF1ZXN0PC90ZXh0PjxwYXRoIGQ9Ik04OSwxNzAuODI4MSBMODksMTk1LjgyODEgTDE3NiwxOTUuODI4MSBMMTc2LDE4MC44MjgxIEwxNjYsMTcwLjgyODEgTDg5LDE3MC44MjgxICIgZmlsbD0iI0ZGRkZGRiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTE2NiwxNzAuODI4MSBMMTY2LDE4MC44MjgxIEwxNzYsMTgwLjgyODEgTDE2NiwxNzAuODI4MSAiIGZpbGw9IiNGRkZGRkYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY2IiB4PSI5NSIgeT0iMTg3Ljg5NSI+bGlmZXRpbWU9MDwvdGV4dD48cGF0aCBkPSJNMzkzLDE3MC44MjgxIEwzOTMsMTk1LjgyODEgTDYzMywxOTUuODI4MSBMNjMzLDE4MC44MjgxIEw2MjMsMTcwLjgyODEgTDM5MywxNzAuODI4MSAiIGZpbGw9IiNGRkZGRkYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik02MjMsMTcwLjgyODEgTDYyMywxODAuODI4MSBMNjMzLDE4MC44MjgxIEw2MjMsMTcwLjgyODEgIiBmaWxsPSIjRkZGRkZGIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMTkiIHg9IjM5OSIgeT0iMTg3Ljg5NSI+c3RvcCBsaWZldGltZeWumuaXtuWZqO+8jOWIoOmZpGFsbG9jYXRpb248L3RleHQ+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxOTIuNSwyMTguMDkzOCwxODIuNSwyMjIuMDkzOCwxOTIuNSwyMjYuMDkzOCwxODguNSwyMjIuMDkzOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTg2LjUiIHgyPSIzODIuNSIgeTE9IjIyMi4wOTM4IiB5Mj0iMjIyLjA5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzMiIHg9IjE5OC41IiB5PSIyMTcuMDI3OCI+UmVmcmVzaCBTdWNjZXNzIFJlc3BvbnNlPC90ZXh0PjwhLS1NRDU9WzhiNDJiYmEyMmE1MTU1YWU2M2JhMGZhMDk5YzMwZjlkXQpAc3RhcnR1bWwNCnNraW5wYXJhbSBOb3RlQmFja2dyb3VuZENvbG9yIHdoaXRlDQoNCmdyb3VwIOe7reacn2FsbG9jYXRpb24NCmNsaWVudCAtPiBzZXJ2ZXIgOiBSZWZyZXNoIFJlcXVlc3QNCmFjdGl2YXRlIHNlcnZlcg0Kbm90ZSBsZWZ0OiBsaWZldGltZT4w77yM6buY6K6kNjAwcw0Kbm90ZSByaWdodDogc2V0IGxpZmV0aW1l77yM5Yi35paw5a6a5pe25ZmoDQpzZXJ2ZXIgLT4gY2xpZW50IDogUmVmcmVzaCBTdWNjZXNzIFJlc3BvbnNlDQpkZWFjdGl2YXRlIHNlcnZlcg0KZW5kDQoNCmdyb3VwIERpc2Nvbm5lY3Qg5pat5byA6L+e5o6lDQpjbGllbnQgLT4gc2VydmVyIDogUmVmcmVzaCBSZXF1ZXN0DQphY3RpdmF0ZSBzZXJ2ZXINCm5vdGUgbGVmdDogbGlmZXRpbWU9MA0Kbm90ZSByaWdodDogc3RvcCBsaWZldGltZeWumuaXtuWZqO+8jOWIoOmZpGFsbG9jYXRpb24NCnNlcnZlciAtPiBjbGllbnQgOiBSZWZyZXNoIFN1Y2Nlc3MgUmVzcG9uc2UNCmRlYWN0aXZhdGUgc2VydmVyDQplbmQNCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMi4xMGJldGEyKFVua25vd24gY29tcGlsZSB0aW1lKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogSmF2YShUTSkgU0UgUnVudGltZSBFbnZpcm9ubWVudApKVk06IEphdmEgSG90U3BvdChUTSkgNjQtQml0IFNlcnZlciBWTQpEZWZhdWx0IEVuY29kaW5nOiBVVEYtOApMYW5ndWFnZTogZW4KQ291bnRyeTogVVMKLS0+PC9nPjwvc3ZnPg=='>

<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://tools.ietf.org/id/draft-ietf-behave-turn-08.html">https://tools.ietf.org/id/draft-ietf-behave-turn-08.html</a></p>
<h3 id="ICE"><a href="#ICE" class="headerlink" title="ICE"></a>ICE</h3><h3 id="interceptor"><a href="#interceptor" class="headerlink" title="interceptor"></a>interceptor</h3><p>处理RTP/RTCP流的框架，它定义了一套处理数据包的interface，实例化函数接口必须按照指定格式进行调用，这个接口定义为<code>Interceptor</code>。</p>
<ul>
<li><p><code>BindRTCPReader</code> 和 <code>BindRTCPWriter</code> 处理incoming和outgoing的RTCP包。</p>
</li>
<li><p><code>BindLocalStream</code> 和 <code>UnbindLocalStream</code> 处理outgoing的RTP包。</p>
</li>
<li><p><code>BindRemoteStream</code> 和 <code>UnbindRemoteStream</code> 处理incoming的RTP包。</p>
</li>
</ul>
<p>chain结构体把interceptor串行在一起，并保证interceptor的执行顺序。</p>
<p>streamInfo是处理媒体流的上下文，用于在interceptor之间传递信息。</p>
<p>对外提供registry结构体，在chain上的又一层封装，暴露Add和Build接口。</p>
<p>它提供了一个<code>type NoOp struct&#123;&#125;</code>的结构体，任何需要实例化interceptor的结构体都可以继承它。</p>
<h4 id="NACK-interceptor的实现"><a href="#NACK-interceptor的实现" class="headerlink" title="NACK interceptor的实现"></a>NACK interceptor的实现</h4><h5 id="GeneratorInterceptor-receiver的实现"><a href="#GeneratorInterceptor-receiver的实现" class="headerlink" title="GeneratorInterceptor receiver的实现"></a>GeneratorInterceptor receiver的实现</h5><p><code>GeneratorInterceptor</code> 是NACK interceptor对外提供的接收端接口。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> GeneratorInterceptor <span class="keyword">struct</span> &#123;</span><br><span class="line">	interceptor.NoOp <span class="comment">// 继承interceptor</span></span><br><span class="line">	size      <span class="keyword">uint16</span> <span class="comment">// receiveLog参数</span></span><br><span class="line">	skipLastN <span class="keyword">uint16</span> <span class="comment">// receiveLog参数</span></span><br><span class="line">	interval  time.Duration <span class="comment">// 发送RTCP包间隔</span></span><br><span class="line">	m         sync.Mutex <span class="comment">// 这个结构体的锁</span></span><br><span class="line">	wg        sync.WaitGroup <span class="comment">// RTCP writer loop结束才可以关闭的控制</span></span><br><span class="line">	<span class="built_in">close</span>     <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125; <span class="comment">// 控制关闭</span></span><br><span class="line">	log       logging.LeveledLogger</span><br><span class="line"></span><br><span class="line">	receiveLogs   <span class="keyword">map</span>[<span class="keyword">uint32</span>]*receiveLog <span class="comment">// 记录了接收到的sequence number， key为SSRC</span></span><br><span class="line">	receiveLogsMu sync.Mutex <span class="comment">// receiveLog的map锁</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="状态控制"><a href="#状态控制" class="headerlink" title="状态控制"></a>状态控制</h6><p>实例化了interceptor的 <code>UnbindLocalStream</code>和<code>BindRemoteStream</code> 用于处理收到的RTP包， 在收到RTP包时将seq num记录在对应SSRC的receiveLog里。<br>实例化了interceptor的 <code>BindRTCPWriter</code> 用于反馈RTCP包，这里起了一个goroutine异步处理， 按定时器间隔来检查receiveLog。</p>
<h6 id="receiveLog实现"><a href="#receiveLog实现" class="headerlink" title="receiveLog实现"></a>receiveLog实现</h6><p>receiveLog是interceptor里实现NACK的重要结构体，它记录了一段连续的包是否收到的情况。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> receiveLog <span class="keyword">struct</span> &#123;</span><br><span class="line">	packets         []<span class="keyword">uint64</span> <span class="comment">// 记录RTP每个包是否收到的bitmap，使用uint64可标识64个包，因此size必须为64的整数倍</span></span><br><span class="line">	size            <span class="keyword">uint16</span> <span class="comment">// 可记录连续的RTP包的总数量</span></span><br><span class="line">	end             <span class="keyword">uint16</span> <span class="comment">// 记录收到的最后一个seq</span></span><br><span class="line">	started         <span class="keyword">bool</span> <span class="comment">// 第一个包，初始化上下文</span></span><br><span class="line">	lastConsecutive <span class="keyword">uint16</span> <span class="comment">// 记录收到的最后一个连续的seq，查找丢失包时，遍历它到end之间即可</span></span><br><span class="line">	m               sync.RWMutex <span class="comment">// 并发锁</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用uint64数组当bitmap，记录收到的RTP包，收到时将bit置1，删除时置0。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *receiveLog)</span> <span class="title">setReceived</span><span class="params">(seq <span class="keyword">uint16</span>)</span></span> &#123;</span><br><span class="line">	pos := seq % s.size</span><br><span class="line">	s.packets[pos/<span class="number">64</span>] |= <span class="number">1</span> &lt;&lt; (pos % <span class="number">64</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *receiveLog)</span> <span class="title">delReceived</span><span class="params">(seq <span class="keyword">uint16</span>)</span></span> &#123;</span><br><span class="line">	pos := seq % s.size</span><br><span class="line">	s.packets[pos/<span class="number">64</span>] &amp;^= <span class="number">1</span> &lt;&lt; (pos % <span class="number">64</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *receiveLog)</span> <span class="title">getReceived</span><span class="params">(seq <span class="keyword">uint16</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	pos := seq % s.size</span><br><span class="line">	<span class="keyword">return</span> (s.packets[pos/<span class="number">64</span>] &amp; (<span class="number">1</span> &lt;&lt; (pos % <span class="number">64</span>))) != <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>每收到一个包，刷新连续的最后一个位置<code>lastConsecutive</code>和记录seq最大的那个位置<code>end</code>。<br>以便在间隔时间检查需要重传包时，只需遍历从<code>lastConsecutive</code>到<code>end</code>之间的那段bit是否为0即可。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *receiveLog)</span> <span class="title">fixLastConsecutive</span><span class="params">()</span></span> &#123;</span><br><span class="line">	i := s.lastConsecutive + <span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> ; i != s.end+<span class="number">1</span> &amp;&amp; s.getReceived(i); i++ &#123;</span><br><span class="line">		<span class="comment">// find all consecutive packets</span></span><br><span class="line">	&#125;</span><br><span class="line">	s.lastConsecutive = i - <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于bitmap的size标识的是一段时间内需要重传的RTP包，每收到一个新的seq时，需要判断这段buffer是否翻转，并清空从end到seq之间的记录。</p>
<h6 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h6><p>算法简单，使用bitmap记录seq，节省内存空间并且查找高效。</p>
<h6 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h6><p>定时器触发NACK请求，重传间隔受定时器间隔影响，实时性不高。<br>没有根据rtt评估是否需要请求重传，在乱序时导致误重传。<br>没有根据retries重试次数来做策略，可能会在网络拥塞严重时一直请求重传，进一步加大了网络拥塞程度。</p>
<h5 id="ResponderInterceptor-sender的实现"><a href="#ResponderInterceptor-sender的实现" class="headerlink" title="ResponderInterceptor sender的实现"></a>ResponderInterceptor sender的实现</h5><p><code>ResponderInterceptor</code> 是NACK interceptor对外提供的发送端接口。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> ResponderInterceptor <span class="keyword">struct</span> &#123;</span><br><span class="line">	interceptor.NoOp <span class="comment">// 继承interceptor</span></span><br><span class="line">	size          <span class="keyword">uint16</span> <span class="comment">// sendBuffer缓存包的数量</span></span><br><span class="line">	log           logging.LeveledLogger</span><br><span class="line">	packetFactory packetFactory <span class="comment">// 提供可定制化packet管理接口，也有默认的packetManager</span></span><br><span class="line"></span><br><span class="line">	streams   <span class="keyword">map</span>[<span class="keyword">uint32</span>]*localStream <span class="comment">// 缓存每个SSRC的包队列</span></span><br><span class="line">	streamsMu sync.Mutex <span class="comment">// streams的map锁</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> localStream <span class="keyword">struct</span> &#123;</span><br><span class="line">	sendBuffer *sendBuffer <span class="comment">// 发送缓存</span></span><br><span class="line">	rtpWriter  interceptor.RTPWriter <span class="comment">// 注册用于发送重传包的回调函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>缓存每个SSRC的发送包，并且注册一个回调函数，用于发送重传包。<br>当收到RTCP NACK请求时，在缓存中查找需要重传的包，并发送给对方。</p>
<h6 id="sendBuffer实现"><a href="#sendBuffer实现" class="headerlink" title="sendBuffer实现"></a>sendBuffer实现</h6><p><code>sendBuffer</code>是发送端缓存，存储最近发送的包，参数<code>size</code>指定缓存的大小。size只能为2的幂次方倍。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> sendBuffer <span class="keyword">struct</span> &#123;</span><br><span class="line">	packets   []*retainablePacket</span><br><span class="line">	size      <span class="keyword">uint16</span></span><br><span class="line">	lastAdded <span class="keyword">uint16</span></span><br><span class="line">	started   <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	m sync.RWMutex</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id=""><a href="#" class="headerlink" title=""></a></h6><h4 id="TWCC-interceptor的实现"><a href="#TWCC-interceptor的实现" class="headerlink" title="TWCC interceptor的实现"></a>TWCC interceptor的实现</h4><h4 id="SR-RR-interceptor的实现"><a href="#SR-RR-interceptor的实现" class="headerlink" title="SR/RR interceptor的实现"></a>SR/RR interceptor的实现</h4><h2 id="ion-sfu"><a href="#ion-sfu" class="headerlink" title="ion-sfu"></a>ion-sfu</h2><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><blockquote>
<p>通过设置环境变量改变pion log的日志级别，例如： export PION_LOG_TRACE=all </p>
</blockquote>
]]></content>
      <categories>
        <category>media</category>
      </categories>
  </entry>
</search>
